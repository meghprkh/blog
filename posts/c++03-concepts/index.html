<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>C++20 Concepts in C++03</title>
		<meta name="description" content="Ramblings and dumb ideas">
		<link rel="alternate" href="/blog/feed/feed.xml" type="application/atom+xml" title="Megh&#39;s Blog">
		<link rel="alternate" href="/blog/feed/feed.json" type="application/json" title="Megh&#39;s Blog">
		
		<style>/**
 * okaidia theme for JavaScript, CSS and HTML
 * Loosely based on Monokai textmate theme by http://www.monokai.nl/
 * @author ocodia
 */

code[class*="language-"],
pre[class*="language-"] {
	color: #f8f8f2;
	background: none;
	text-shadow: 0 1px rgba(0, 0, 0, 0.3);
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
	border-radius: 0.3em;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #272822;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: #8292a2;
}

.token.punctuation {
	color: #f8f8f2;
}

.token.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.constant,
.token.symbol,
.token.deleted {
	color: #f92672;
}

.token.boolean,
.token.number {
	color: #ae81ff;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #a6e22e;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string,
.token.variable {
	color: #f8f8f2;
}

.token.atrule,
.token.attr-value,
.token.function,
.token.class-name {
	color: #e6db74;
}

.token.keyword {
	color: #66d9ef;
}

.token.regex,
.token.important {
	color: #fd971f;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
/*
 * New diff- syntax
 */

pre[class*="language-diff-"] {
	--eleventy-code-padding: 1.25em;
	padding-left: var(--eleventy-code-padding);
	padding-right: var(--eleventy-code-padding);
}
.token.deleted {
	background-color: hsl(0, 51%, 37%);
	color: inherit;
}
.token.inserted {
	background-color: hsl(126, 31%, 39%);
	color: inherit;
}

/* Make the + and - characters unselectable for copy/paste */
.token.prefix.unchanged,
.token.prefix.inserted,
.token.prefix.deleted {
	-webkit-user-select: none;
	user-select: none;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	padding-top: 2px;
	padding-bottom: 2px;
}
.token.prefix.inserted,
.token.prefix.deleted {
	width: var(--eleventy-code-padding);
	background-color: rgba(0, 0, 0, 0.2);
}

/* Optional: full-width background color */
.token.inserted:not(.prefix),
.token.deleted:not(.prefix) {
	display: block;
	margin-left: calc(-1 * var(--eleventy-code-padding));
	margin-right: calc(-1 * var(--eleventy-code-padding));
	text-decoration: none; /* override del, ins, mark defaults */
	color: inherit; /* override del, ins, mark defaults */
}
* { box-sizing: border-box; }
/* Defaults */
:root {
	--font-family: -apple-system, system-ui, sans-serif;
	--font-family-monospace:
		Consolas, Menlo, Monaco, Andale Mono WT, Andale Mono, Lucida Console,
		Lucida Sans Typewriter, DejaVu Sans Mono, Bitstream Vera Sans Mono,
		Liberation Mono, Nimbus Mono L, Courier New, Courier, monospace;
}

/* Theme colors */
:root {
	--color-gray-20: #e0e0e0;
	--color-gray-50: #c0c0c0;
	--color-gray-90: #333;

	--background-color: #fff;

	--text-color: var(--color-gray-90);
	--text-color-link: #082840;
	--text-color-link-active: #5f2b48;
	--text-color-link-visited: #17050f;

	--syntax-tab-size: 2;
}

@media (prefers-color-scheme: dark) {
	:root {
		--color-gray-20: #e0e0e0;
		--color-gray-50: #c0c0c0;
		--color-gray-90: #dad8d8;

		/* --text-color is assigned to --color-gray-_ above */
		--text-color-link: #1493fb;
		--text-color-link-active: #6969f7;
		--text-color-link-visited: #a6a6f8;

		--background-color: #15202b;
	}
}

/* Global stylesheet */
* {
	box-sizing: border-box;
}

html,
body {
	padding: 0;
	margin: 0 auto;
	font-family: var(--font-family);
	color: var(--text-color);
	background-color: var(--background-color);
}
html {
	overflow-y: scroll;
}
body {
	max-width: 50em;
}

/* https://www.a11yproject.com/posts/how-to-hide-content/ */
.visually-hidden {
	clip: rect(0 0 0 0);
	clip-path: inset(50%);
	height: 1px;
	overflow: hidden;
	position: absolute;
	white-space: nowrap;
	width: 1px;
}

p:last-child {
	margin-bottom: 0;
}
p {
	line-height: 1.5;
}

li {
	line-height: 1.5;
}

a[href] {
	color: var(--text-color-link);
}
a[href]:visited {
	color: var(--text-color-link-visited);
}
a[href]:hover,
a[href]:active {
	color: var(--text-color-link-active);
}

main {
	padding: 1rem;
}
main :first-child {
	margin-top: 0;
}

header {
	border-bottom: 1px dashed var(--color-gray-20);
}
header:after {
	content: "";
	display: table;
	clear: both;
}

.links-nextprev {
	list-style: none;
	border-top: 1px dashed var(--color-gray-20);
	padding: 1em 0;
}

table {
	margin: 1em 0;
}
table td,
table th {
	padding-right: 1em;
}

pre,
code,
code[class*="language-"],
pre[class*="language-"] {
	font-family: var(--font-family-monospace);
	font-size: 0.95em;
	line-height: 1.5;
}
pre:not([class*="language-"]) {
	background: #272822;
	padding: 1em;
	margin: 0.5em 0;
	overflow: auto;
	line-height: 1.375; /* 22px /16 */
	-moz-tab-size: var(--syntax-tab-size);
	-o-tab-size: var(--syntax-tab-size);
	tab-size: var(--syntax-tab-size);
	-webkit-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
	direction: ltr;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
}
code {
	word-break: break-all;
}

/* Header */
header {
	display: flex;
	gap: 1em 0.5em;
	flex-wrap: wrap;
	align-items: center;
	padding: 1em;
}
.home-link {
	font-size: 1em; /* 16px /16 */
	font-weight: 700;
	margin-right: 2em;
}
.home-link:link:not(:hover) {
	text-decoration: none;
}

/* Nav */
.nav {
	display: flex;
	padding: 0;
	margin: 0;
	list-style: none;
}
.nav-item {
	display: inline-block;
	margin-right: 1em;
}
.nav-item a[href]:not(:hover) {
	text-decoration: none;
}
.nav a[href][aria-current="page"] {
	text-decoration: underline;
}

/* Posts list */
.postlist {
	list-style: none;
	padding: 0;
	padding-left: 1.5rem;
}
.postlist-item {
	display: flex;
	flex-wrap: wrap;
	align-items: baseline;
	counter-increment: start-from -1;
	margin-bottom: 1em;
}
.postlist-item:before {
	display: inline-block;
	pointer-events: none;
	content: "" counter(start-from, decimal-leading-zero) ". ";
	line-height: 100%;
	text-align: right;
	margin-left: -1.5rem;
}
.postlist-date,
.postlist-item:before {
	font-size: 0.8125em; /* 13px /16 */
	color: var(--color-gray-90);
}
.postlist-date {
	word-spacing: -0.5px;
}
.postlist-link {
	font-size: 1.1875em; /* 19px /16 */
	font-weight: 700;
	flex-basis: calc(100% - 1.5rem);
	padding-left: 0.25em;
	padding-right: 0.5em;
	text-underline-position: from-font;
	text-underline-offset: 0;
	text-decoration-thickness: 1px;
}
.postlist-item-active .postlist-link {
	font-weight: bold;
}

/* Tags */
.post-tag {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	text-transform: capitalize;
	font-style: italic;
}
.postlist-item > .post-tag {
	align-self: center;
}

/* Tags list */
.post-metadata {
	display: inline-flex;
	flex-wrap: wrap;
	gap: 0.5em;
	list-style: none;
	padding: 0;
	margin: 0;
}
.post-metadata time {
	margin-right: 1em;
}

/* Direct Links / Markdown Headers */
.header-anchor {
	text-decoration: none;
	font-style: normal;
	font-size: 1em;
	margin-left: 0.1em;
}
a[href].header-anchor,
a[href].header-anchor:visited {
	color: transparent;
}
a[href].header-anchor:focus,
a[href].header-anchor:hover {
	text-decoration: underline;
}
a[href].header-anchor:focus,
:hover > a[href].header-anchor {
	color: #aaa;
}

h2 + .header-anchor {
	font-size: 1.5em;
}

/* Modified */
table,
th,
td {
	border: 1px solid;
	padding: 0.5em;
}

table {
	width: 100%;
	border-collapse: collapse;
}

/* Table of Contents */
#TableOfContents {
	margin: 1em 0em;
}
#TableOfContents > nav > ol::before {
	content: "Table of Contents";
	font-weight: bold;
	text-align: center;
	display: block;
	margin-left: -1.25em;
}

#TableOfContents > nav > ol {
	border: 1px dashed var(--color-gray-90);
	padding: 0.75em 0.75em 0.75em 2em;
}

#TableOfContents .active {
	color: var(--text-color-link-active);
}

@media (min-width: 80em) {
	#TableOfContents {
		display: block;
		width: calc(50vw - 29em);
		max-width: 20em;
		position: -webkit-sticky;
		position: sticky;
		height: 0;
		top: 3.5em;
		margin: 0em;
		margin-left: 52em;
		background: none;
	}
}

/* Misc */
.code-play-button {
	position: relative;
}

.code-play-button a {
	position: absolute;
	text-decoration: none;
	right: 0em;
	width: 1.25em;
	display: inline-block;
	font-size: 1.5em;
	color: white;
	content: "\25B6";
}</style>
	</head>
	<body>
		<a href="#skip" class="visually-hidden">Skip to main content</a>

		<header>
			<a href="/blog/" class="home-link">Megh&#39;s Blog</a>
			<nav>
				<h2 class="visually-hidden">Top level navigation menu</h2>
				<ul class="nav">
					<li class="nav-item"><a href="/blog/">Home</a></li>
					<li class="nav-item"><a href="/blog/archive/">Archive</a></li>
					<li class="nav-item"><a href="/blog/about/">About Me</a></li>
					<li class="nav-item"><a href="https://meghprkh.github.io/">Portfolio</a></li>
				</ul>
			</nav>
		</header>

		<main id="skip">
			
<h1>C++20 Concepts in C++03</h1>

<ul class="post-metadata">
	<li><time datetime="2022-08-04">04 August 2022</time></li>
	<li><a href="/blog/tags/c/" class="post-tag">C++</a>, </li>
	<li><a href="/blog/tags/rust/" class="post-tag">Rust</a>, </li>
	<li><a href="/blog/tags/series-btrait-intro/" class="post-tag">series-btrait-intro</a></li>
</ul>

<aside id="TableOfContents">
  <nav class="toc">
        <ol><li><a href="#what-are-c-concepts">What are C++ Concepts</a></li><li><a href="#c-03-concepts">C++03 Concepts</a></li><li><a href="#aside-explicit-concepts-in-c-20">Aside: Explicit concepts in C++20</a></li><li><a href="#rant-on-c-20-concepts">Rant on C++20 Concepts</a></li><li><a href="#extra-syntactic-sugar-stuff">Extra syntactic sugar stuff</a></li><li><a href="#summary">Summary</a></li></ol>
      </nav>
</aside>
<p>C++20 Concepts are a new language feature that ease generic programming, but are primarily syntactic sugar.</p>
<p>We will try to implement them in C++03, with one caveat - we must <em>explicitly specify that a class implements an concept</em>.</p>
<p><strong>NOTE</strong>: We will use template specialization and do not need to be able to modify the class or our concept for this.</p>
<p><strong>NOTE</strong>: If it seems like the caveat ignores the entire point of concepts, call these &quot;pseudo-minimal-rust-traits&quot; and read on. By the end of the article, as the Zen of Python mentions, I promise you will agree that explicit is better than implicit :P</p>
<h2 id="what-are-c-concepts" tabindex="-1">What are C++ Concepts <a class="header-anchor" href="#what-are-c-concepts">#</a></h2>
<p>C++ Concepts allow us to do compile-time dispatch of methods.</p>
<p>This compile-time dispatch is thus kind of like Rust traits. (Rust traits provide other features too.)</p>
<div class="code-play-button">
    <a href="https://godbolt.org/clientstate/eyJzZXNzaW9ucyI6W3siaWQiOjEsImxhbmd1YWdlIjoiYysrIiwiY29tcGlsZXJzIjpbeyJpZCI6ImcxMjEiLCJvcHRpb25zIjoiLXN0ZD1jKysyMCJ9XSwiZXhlY3V0b3JzIjpbeyJjb21waWxlciI6eyJpZCI6ImcxMjEiLCJvcHRpb25zIjoiLXN0ZD1jKysyMCJ9LCJjb21waWxlck91dHB1dFZpc2libGUiOiJ0cnVlIn1dLCJzb3VyY2UiOiIjaW5jbHVkZSA8aW9zdHJlYW0%2BXG4jaW5jbHVkZSA8Y29uY2VwdHM%2BXG5cbi8vIERlZmluZSB0aGUgY29uY2VwdCBjaGVja1xudGVtcGxhdGUgPHR5cGVuYW1lIFNlbGY%2BXG5jb25jZXB0IENvdW50ZXIgPSByZXF1aXJlcyhTZWxmIGNvdW50ZXIsIGludCBuZXdfY291bnQpIHtcbiAgICB7IGNvdW50ZXIuZ2V0X2NvdW50KCkgfSAtPiBzdGQ6OnNhbWVfYXM8aW50PjtcbiAgICB7IGNvdW50ZXIuc2V0X2NvdW50KG5ld19jb3VudCkgfSAtPiBzdGQ6OnNhbWVfYXM8dm9pZD47XG4gICAgeyBTZWxmOjptYXhfY291bnQoKSB9IC0%2BIHN0ZDo6c2FtZV9hczxpbnQ%2BO1xufTtcblxuLy8gT3VyIHN0cnVjdFxuc3RydWN0IE15Q291bnRlciB7XG4gICAgaW50IGNvdW50O1xuXG4gICAgaW50IGdldF9jb3VudCgpIHsgcmV0dXJuIGNvdW50OyB9XG4gICAgdm9pZCBzZXRfY291bnQoaW50IG5ld19jb3VudCkgeyBjb3VudCA9IG5ld19jb3VudDsgfVxuICAgIHN0YXRpYyBpbnQgbWF4X2NvdW50KCkgeyByZXR1cm4gMTAwOyB9XG59O1xuc3RhdGljX2Fzc2VydChDb3VudGVyPE15Q291bnRlcj4pOyAvLyBvcHRpb25hbGx5IGNoZWNrIGltcGxlbWVudGF0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmIHdlIGZvcmdvdCBhbnkgbWV0aG9kcywgZXRjLi4uXG5cbi8vIEV4YW1wbGUgdXNhZ2VcbnRlbXBsYXRlIDx0eXBlbmFtZSBUPlxucmVxdWlyZXMgQ291bnRlcjxUPlxudm9pZCBwcmludF9jb3VudGVyKFQmIGNvdW50ZXIpIHtcbiAgICAvLyBDYW4gYWxzbyB1c2Ugc2hvcnRoYW5kIGB0ZW1wbGF0ZSA8Q291bnRlciBUPmAgaW5zdGVhZCBvZiBgcmVxdWlyZXNgIGNsYXVzZVxuICAgIHN0ZDo6Y291dCA8PCBcIkNvdW50ZXIgd2l0aCBjb3VudCBcIiA8PCBjb3VudGVyLmdldF9jb3VudCgpIDw8IHN0ZDo6ZW5kbDtcbn1cblxuLy8gY29tcGlsZS10aW1lIGRpc3BhdGNoIGFub3RoZXIgbWV0aG9kXG52b2lkIHByaW50X2NvdW50ZXIoaW50IGNvdW50ZXIpIHtcbiAgICBzdGQ6OmNvdXQgPDwgXCJJbnRlZ2VyIGNvdW50ZXIgd2l0aCBjb3VudCBcIiA8PCBjb3VudGVyIDw8IHN0ZDo6ZW5kbDtcbn1cblxuLy8gU2hvcnRoYW5kIHN5bnRheFxudm9pZCBwcmludF9jb3VudGVyX3Nob3J0aGFuZChDb3VudGVyIGF1dG8gY291bnRlcikgeyBwcmludF9jb3VudGVyKGNvdW50ZXIpOyB9XG5cbmludCBtYWluKCkge1xuICAgIE15Q291bnRlciBjIHsgMjUgfTtcbiAgICBwcmludF9jb3VudGVyKGMpO1xuICAgIHByaW50X2NvdW50ZXIoMTApOyAvLyBQcmludHMgSW50ZWdlciBjb3VudGVyXG4gICAgcHJpbnRfY291bnRlcl9zaG9ydGhhbmQoYyk7XG59In1dfQ%3D%3D" target="_blank">&#x25B6;</a>
</div>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token comment">// Define the concept check</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">Self</span><span class="token operator">></span>
<span class="token keyword">concept</span> <span class="token class-name">Counter</span> <span class="token operator">=</span> <span class="token keyword">requires</span><span class="token punctuation">(</span>Self counter<span class="token punctuation">,</span> <span class="token keyword">int</span> new_count<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">{</span> counter<span class="token punctuation">.</span><span class="token function">get_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token operator">-></span> std<span class="token double-colon punctuation">::</span>same_as<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token punctuation">;</span>
    <span class="token punctuation">{</span> counter<span class="token punctuation">.</span><span class="token function">set_count</span><span class="token punctuation">(</span>new_count<span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token operator">-></span> std<span class="token double-colon punctuation">::</span>same_as<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">></span><span class="token punctuation">;</span>
    <span class="token punctuation">{</span> <span class="token class-name">Self</span><span class="token double-colon punctuation">::</span><span class="token function">max_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token operator">-></span> std<span class="token double-colon punctuation">::</span>same_as<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Our struct</span>
<span class="token keyword">struct</span> <span class="token class-name">MyCounter</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> count<span class="token punctuation">;</span>

    <span class="token keyword">int</span> <span class="token function">get_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> count<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">void</span> <span class="token function">set_count</span><span class="token punctuation">(</span><span class="token keyword">int</span> new_count<span class="token punctuation">)</span> <span class="token punctuation">{</span> count <span class="token operator">=</span> new_count<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">max_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token number">100</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">static_assert</span><span class="token punctuation">(</span>Counter<span class="token operator">&lt;</span>MyCounter<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// optionally check implementation</span>
                                   <span class="token comment">// if we forgot any methods, etc...</span>

<span class="token comment">// Example usage</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">></span>
<span class="token keyword">requires</span> Counter<span class="token operator">&lt;</span>T<span class="token operator">></span>
<span class="token keyword">void</span> <span class="token function">print_counter</span><span class="token punctuation">(</span>T<span class="token operator">&amp;</span> counter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Can also use shorthand `template &lt;Counter T>` instead of `requires` clause</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Counter with count "</span> <span class="token operator">&lt;&lt;</span> counter<span class="token punctuation">.</span><span class="token function">get_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// compile-time dispatch another method</span>
<span class="token keyword">void</span> <span class="token function">print_counter</span><span class="token punctuation">(</span><span class="token keyword">int</span> counter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Integer counter with count "</span> <span class="token operator">&lt;&lt;</span> counter <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Shorthand syntax</span>
<span class="token keyword">void</span> <span class="token function">print_counter_shorthand</span><span class="token punctuation">(</span>Counter <span class="token keyword">auto</span> counter<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">print_counter</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    MyCounter c <span class="token punctuation">{</span> <span class="token number">25</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">print_counter</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">print_counter</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Prints Integer counter</span>
    <span class="token function">print_counter_shorthand</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>Notice that we never needed to specify that <code>MyCounter</code> implements <code>Counter</code>. This can easily be fixed by requiring some constant to be defined in <code>MyCounter</code> or otherwise.</p>
<p>We call the above <strong>&quot;implicit concepts&quot;</strong>. We will try to implement <strong>&quot;explicit concepts&quot;</strong> - where something must specify that the concept has been implemented for a class.</p>
<h2 id="c-03-concepts" tabindex="-1">C++03 Concepts <a class="header-anchor" href="#c-03-concepts">#</a></h2>
<p>We will use C++11 initially. Then will also modify this using some macros for C++03.</p>
<p>We use a templated struct and observe that <code>static_asserts</code> inside it are executed when the template is specialized.</p>
<div class="code-play-button">
    <a href="https://godbolt.org/clientstate/eyJzZXNzaW9ucyI6W3siaWQiOjEsImxhbmd1YWdlIjoiYysrIiwiY29tcGlsZXJzIjpbeyJpZCI6ImcxMjEiLCJvcHRpb25zIjoiLXN0ZD1jKysxMSJ9XSwiZXhlY3V0b3JzIjpbeyJjb21waWxlciI6eyJpZCI6ImcxMjEiLCJvcHRpb25zIjoiLXN0ZD1jKysxMSJ9LCJjb21waWxlck91dHB1dFZpc2libGUiOiJ0cnVlIn1dLCJzb3VyY2UiOiIjaW5jbHVkZSA8aW9zdHJlYW0%2BXG4jaW5jbHVkZSA8dHlwZV90cmFpdHM%2BXG5cbi8vIERlZmluZSB0aGUgY29uY2VwdFxuc3RydWN0IENvdW50ZXIge1xuICAgIC8vIFRoaXMgdGVtcGxhdGUgaXMgc3BlY2lhbGl6ZWQgdG8gdHJ1ZV90eXBlIGJ5IGFueSBjbGFzcyB0aGF0XG4gICAgLy8gaW1wbGVtZW50cyB0aGlzLiBTcGVjaWFsaXphdGlvbiByZXF1aXJlcyBvd25lcnNoaXAgb2YgbmVpdGhlclxuICAgIC8vIENvdW50ZXIgY29uY2VwdCBvciBTZWxmIChTZWxmIGJlaW5nIHRoZSBjbGFzcyBpbiBxdWVzdGlvbilcbiAgICB0ZW1wbGF0ZSA8dHlwZW5hbWUgU2VsZj5cbiAgICBzdHJ1Y3QgaXNfaW1wbGVtZW50ZWRfYnk6IHN0ZDo6ZmFsc2VfdHlwZSB7fTtcblxuICAgIC8vIERlZmluZSB0aGUgY2hlY2tcbiAgICB0ZW1wbGF0ZSA8dHlwZW5hbWUgU2VsZj5cbiAgICBzdHJ1Y3QgY2hlY2s6IHN0ZDo6dHJ1ZV90eXBlIHtcbiAgICAgICAgc3RhdGljX2Fzc2VydChzdGF0aWNfY2FzdDwgaW50IChTZWxmOjoqKSgpID4oJlNlbGY6OmdldF9jb3VudCkpO1xuICAgICAgICBzdGF0aWNfYXNzZXJ0KHN0YXRpY19jYXN0PCB2b2lkIChTZWxmOjoqKShpbnQpID4oJlNlbGY6OnNldF9jb3VudCkpO1xuICAgICAgICBzdGF0aWNfYXNzZXJ0KHN0YXRpY19jYXN0PCBpbnQgKCopKCkgPigmU2VsZjo6bWF4X2NvdW50KSk7XG4gICAgfTtcbn07XG5cbi8vIERlZmluZSBvdXIgc3RydWN0IG5vcm1hbGx5LCB3aXRob3V0IGFueSBtb2RpZmljYXRpb25zXG5zdHJ1Y3QgTXlDb3VudGVyIHtcbiAgICBpbnQgY291bnQ7XG5cbiAgICBpbnQgZ2V0X2NvdW50KCkgeyByZXR1cm4gY291bnQ7IH1cbiAgICB2b2lkIHNldF9jb3VudChpbnQgbmV3X2NvdW50KSB7IGNvdW50ID0gbmV3X2NvdW50OyB9XG4gICAgc3RhdGljIGludCBtYXhfY291bnQoKSB7IHJldHVybiAxMDA7IH1cbn07XG4vLyBEZWNsYXJlIGFuZCBjaGVjayB0aGF0IHdlIGhhdmUgaW1wbGVtZW50ZWQgdGhlIHRyYWl0XG50ZW1wbGF0ZTw%2BXG5zdHJ1Y3QgQ291bnRlcjo6aXNfaW1wbGVtZW50ZWRfYnk8TXlDb3VudGVyPjogQ291bnRlcjo6Y2hlY2s8TXlDb3VudGVyPiB7fTtcblxuLy8gRXhhbXBsZSB1c2FnZSB1c2luZyBjbGFzc2ljIGVuYWJsZV9pZiBTRklOQUUuIFZlcmJvc2UgeWV0IGNvbnZlbnRpb25hbFxudGVtcGxhdGUgPHR5cGVuYW1lIFQ%2BXG50eXBlbmFtZSBzdGQ6OmVuYWJsZV9pZjxcbiAgICBDb3VudGVyOjppc19pbXBsZW1lbnRlZF9ieTxUPjo6dmFsdWUsXG52b2lkID46OnR5cGVcbnByaW50X2NvdW50ZXIoVCYgY291bnRlcikge1xuICAgIHN0ZDo6Y291dCA8PCBcIkNvdW50ZXIgd2l0aCBjb3VudCBcIiA8PCBjb3VudGVyLmdldF9jb3VudCgpIDw8IHN0ZDo6ZW5kbDtcbn1cblxuLy8gY29tcGlsZS10aW1lIGRpc3BhdGNoIGFub3RoZXIgbWV0aG9kXG52b2lkIHByaW50X2NvdW50ZXIoaW50IGNvdW50ZXIpIHtcbiAgICBzdGQ6OmNvdXQgPDwgXCJJbnRlZ2VyIGNvdW50ZXIgd2l0aCBjb3VudCBcIiA8PCBjb3VudGVyIDw8IHN0ZDo6ZW5kbDtcbn1cblxuaW50IG1haW4oKSB7XG4gICAgTXlDb3VudGVyIGNvdW50ZXIgeyAyNSB9O1xuICAgIHByaW50X2NvdW50ZXIoY291bnRlcik7XG4gICAgcHJpbnRfY291bnRlcigxMCk7IC8vIFByaW50cyBJbnRlZ2VyIGNvdW50ZXJcbn0ifV19" target="_blank">&#x25B6;</a>
</div>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token comment">// Define the concept</span>
<span class="token keyword">struct</span> <span class="token class-name">Counter</span> <span class="token punctuation">{</span>
    <span class="token comment">// This template is specialized to true_type by any class that</span>
    <span class="token comment">// implements this. Specialization requires ownership of neither</span>
    <span class="token comment">// Counter concept or Self (Self being the class in question)</span>
    <span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">Self</span><span class="token operator">></span>
    <span class="token keyword">struct</span> <span class="token class-name">is_implemented_by</span><span class="token operator">:</span> <span class="token base-clause">std<span class="token double-colon punctuation">::</span><span class="token class-name">false_type</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// Define the check</span>
    <span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">Self</span><span class="token operator">></span>
    <span class="token keyword">struct</span> <span class="token class-name">check</span><span class="token operator">:</span> <span class="token base-clause">std<span class="token double-colon punctuation">::</span><span class="token class-name">true_type</span></span> <span class="token punctuation">{</span>
        <span class="token keyword">static_assert</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span> <span class="token keyword">int</span> <span class="token punctuation">(</span>Self<span class="token double-colon punctuation">::</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Self<span class="token double-colon punctuation">::</span>get_count<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">static_assert</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span> <span class="token keyword">void</span> <span class="token punctuation">(</span>Self<span class="token double-colon punctuation">::</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Self<span class="token double-colon punctuation">::</span>set_count<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">static_assert</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span> <span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Self<span class="token double-colon punctuation">::</span>max_count<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Define our struct normally, without any modifications</span>
<span class="token keyword">struct</span> <span class="token class-name">MyCounter</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> count<span class="token punctuation">;</span>

    <span class="token keyword">int</span> <span class="token function">get_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> count<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">void</span> <span class="token function">set_count</span><span class="token punctuation">(</span><span class="token keyword">int</span> new_count<span class="token punctuation">)</span> <span class="token punctuation">{</span> count <span class="token operator">=</span> new_count<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">max_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token number">100</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Declare and check that we have implemented the trait</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token operator">></span>
<span class="token keyword">struct</span> <span class="token class-name">Counter</span><span class="token operator">:</span><span class="token base-clause"><span class="token operator">:</span><span class="token class-name">is_implemented_by</span><span class="token operator">&lt;</span><span class="token class-name">MyCounter</span><span class="token operator">></span><span class="token operator">:</span> Counter<span class="token double-colon punctuation">::</span><span class="token class-name">check</span><span class="token operator">&lt;</span><span class="token class-name">MyCounter</span><span class="token operator">></span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Example usage using classic enable_if SFINAE. Verbose yet conventional</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">></span>
<span class="token keyword">typename</span> <span class="token class-name">std</span><span class="token double-colon punctuation">::</span>enable_if<span class="token operator">&lt;</span>
    Counter<span class="token double-colon punctuation">::</span>is_implemented_by<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token double-colon punctuation">::</span>value<span class="token punctuation">,</span>
<span class="token keyword">void</span> <span class="token operator">></span><span class="token double-colon punctuation">::</span>type
<span class="token function">print_counter</span><span class="token punctuation">(</span>T<span class="token operator">&amp;</span> counter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Counter with count "</span> <span class="token operator">&lt;&lt;</span> counter<span class="token punctuation">.</span><span class="token function">get_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// compile-time dispatch another method</span>
<span class="token keyword">void</span> <span class="token function">print_counter</span><span class="token punctuation">(</span><span class="token keyword">int</span> counter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Integer counter with count "</span> <span class="token operator">&lt;&lt;</span> counter <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    MyCounter counter <span class="token punctuation">{</span> <span class="token number">25</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">print_counter</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">print_counter</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Prints Integer counter</span>
<span class="token punctuation">}</span></code></pre>
<p>To do this in C++03, and make it work with C++11 too, lets sprinkle some macros.</p>
<div class="code-play-button">
    <a href="https://godbolt.org/clientstate/eyJzZXNzaW9ucyI6W3siaWQiOjEsImxhbmd1YWdlIjoiYysrIiwiY29tcGlsZXJzIjpbeyJpZCI6ImcxMjEiLCJvcHRpb25zIjoiLXN0ZD1jKyswMyJ9XSwiZXhlY3V0b3JzIjpbeyJjb21waWxlciI6eyJpZCI6ImcxMjEiLCJvcHRpb25zIjoiLXN0ZD1jKyswMyJ9LCJjb21waWxlck91dHB1dFZpc2libGUiOiJ0cnVlIn1dLCJzb3VyY2UiOiIjaW5jbHVkZSA8aW9zdHJlYW0%2BXG5cbiNpZiBfX2NwbHVzcGx1cyAhPSAxOTk3MTFMXG4jaW5jbHVkZSA8dHlwZV90cmFpdHM%2BXG4jZWxzZVxuLy8gTW9ua2V5IHBhdGNoIHN0ZCBmb3IgdGhlIHNha2Ugb2YgdGhlIGV4YW1wbGVcbi8vIENhbiB1c2UgeW91ciBmYXZvdXJpdGUgdXRpbGl0eSBsaWJyYXJ5IGluc3RlYWRcbm5hbWVzcGFjZSBzdGQge1xuICAgIHN0cnVjdCB0cnVlX3R5cGUgeyBzdGF0aWMgY29uc3QgYm9vbCB2YWx1ZSA9IHRydWU7IH07XG4gICAgc3RydWN0IGZhbHNlX3R5cGUgeyBzdGF0aWMgY29uc3QgYm9vbCB2YWx1ZSA9IHRydWU7IH07XG4gICAgdGVtcGxhdGUgPGJvb2wgQ29uZCwgdHlwZW5hbWUgVHlwZSA9IHZvaWQ%2BXG4gICAgc3RydWN0IGVuYWJsZV9pZiB7IHR5cGVkZWYgVHlwZSB0eXBlOyB9O1xuICAgIHRlbXBsYXRlIDx0eXBlbmFtZSBUeXBlPlxuICAgIHN0cnVjdCBlbmFibGVfaWY8ZmFsc2UsIFR5cGU%2BIHsgfTtcbn1cbiNlbmRpZlxuXG4jZGVmaW5lIF9DT05DRVBUX1RPS0VOUEFTVEUoeCwgeSkgeCAjIyB5XG4jZGVmaW5lIF9DT05DRVBUX1RPS0VOUEFTVEUyKHgsIHkpIF9DT05DRVBUX1RPS0VOUEFTVEUoeCwgeSlcblxuI2lmIF9fY3BsdXNwbHVzICE9IDE5OTcxMUxcblxuI2RlZmluZSBDT05DRVBUX0NIRUNLX0JFR0lOIFxcXG4gICAgdGVtcGxhdGUgPHR5cGVuYW1lIFNlbGY%2BIFxcXG4gICAgc3RydWN0IGNoZWNrOiBzdGQ6OnRydWVfdHlwZSB7IFxcXG5cbiNkZWZpbmUgQ09OQ0VQVF9DSEVDS19FTkQgfTtcblxuI2RlZmluZSBDT05DRVBUX0FTU0VSVCBzdGF0aWNfYXNzZXJ0XG5cbiNkZWZpbmUgSU1QTF9DT05DRVBUKENPTkNFUFQsIENMUykgXFxcbiAgICB0ZW1wbGF0ZTw%2BIFxcXG4gICAgc3RydWN0IENPTkNFUFQ6OmlzX2ltcGxlbWVudGVkX2J5PENMUz46IENPTkNFUFQ6OmNoZWNrPENMUz4ge307IFxcXG5cbiNlbHNlXG5cbi8vIEluIEMrKzAzIHdlIGRvbnQgaGF2ZSBzdGF0aWNfYXNzZXJ0IGFuZCB3ZSBjYW5ub3QgdXNlIFwiJlQ6Om1ldGhvZFwiXG4vLyBpbnNpZGUgc2F5IGEgQk9PU1RfU1RBVElDX0FTU0VSVC5cbi8vIFdlIGp1c3QgZGVmaW5lIGFsbCBvZiB0aGUgY2hlY2tzIGluc2lkZSB0aGUgY29uc3RydWN0b3Igb2YgYGNoZWNrYC5cbi8vIFRoZW4gaW4gYElNUExfQ09OQ0VQVGAgd2UgaW5zdGFudGlhdGUgYSBzdGF0aWMgb2JqZWN0IG9mIHRoZSBzYW1lLlxuXG4jZGVmaW5lIENPTkNFUFRfQ0hFQ0tfQkVHSU4gXFxcbiAgICB0ZW1wbGF0ZSA8dHlwZW5hbWUgU2VsZj4gXFxcbiAgICBzdHJ1Y3QgY2hlY2s6IHN0ZDo6dHJ1ZV90eXBlIHsgXFxcbiAgICAgICAgY2hlY2soKSB7IFxcXG5cbiNkZWZpbmUgQ09OQ0VQVF9DSEVDS19FTkQgfSB9O1xuXG52b2lkIF9jb25jZXB0X2Fzc2VydChib29sKSB7fVxuI2RlZmluZSBDT05DRVBUX0FTU0VSVCBfY29uY2VwdF9hc3NlcnRcblxuI2RlZmluZSBJTVBMX0NPTkNFUFQoQ09OQ0VQVCwgQ0xTKSBcXFxuICAgIHRlbXBsYXRlPD4gXFxcbiAgICBzdHJ1Y3QgQ09OQ0VQVDo6aXNfaW1wbGVtZW50ZWRfYnk8Q0xTPjogQ09OQ0VQVDo6Y2hlY2s8Q0xTPiB7fTsgXFxcbiAgICBzdGF0aWMgQ09OQ0VQVDo6Y2hlY2s8Q0xTPiBfQ09OQ0VQVF9UT0tFTlBBU1RFMihfY29uY2VwdF9jaGVja18sIF9fTElORV9fKTsgXFxcblxuI2VuZGlmXG5cbi8vIERlZmluZSB0aGUgY29uY2VwdFxuc3RydWN0IENvdW50ZXIge1xuICAgIHRlbXBsYXRlIDx0eXBlbmFtZSBUPlxuICAgIHN0cnVjdCBpc19pbXBsZW1lbnRlZF9ieTogc3RkOjpmYWxzZV90eXBlIHt9O1xuXG4gICAgLy8gRGVmaW5lIHRoZSBjaGVja1xuICAgIENPTkNFUFRfQ0hFQ0tfQkVHSU5cbiAgICAgICAgQ09OQ0VQVF9BU1NFUlQoc3RhdGljX2Nhc3Q8IGludCAoU2VsZjo6KikoKSA%2BKCZTZWxmOjpnZXRfY291bnQpKTtcbiAgICAgICAgQ09OQ0VQVF9BU1NFUlQoc3RhdGljX2Nhc3Q8IHZvaWQgKFNlbGY6OiopKGludCkgPigmU2VsZjo6c2V0X2NvdW50KSk7XG4gICAgICAgIENPTkNFUFRfQVNTRVJUKHN0YXRpY19jYXN0PCBpbnQgKCopKCkgPigmU2VsZjo6bWF4X2NvdW50KSk7XG4gICAgQ09OQ0VQVF9DSEVDS19FTkRcbn07XG5cbi8vIERlZmluZSBvdXIgc3RydWN0XG5zdHJ1Y3QgTXlDb3VudGVyIHtcbiAgICBpbnQgY291bnQ7XG5cbiAgICBpbnQgZ2V0X2NvdW50KCkgeyByZXR1cm4gY291bnQ7IH1cbiAgICB2b2lkIHNldF9jb3VudChpbnQgbmV3X2NvdW50KSB7IGNvdW50ID0gbmV3X2NvdW50OyB9XG4gICAgc3RhdGljIGludCBtYXhfY291bnQoKSB7IHJldHVybiAxMDA7IH1cbn07XG4vLyAuLi4gc2tpcHBpbmcgZGVmaW5pdGlvbiBvZiBzdHJ1Y3QgTXlDb3VudGVyIC4uLlxuLy8gRGVjbGFyZSBhbmQgY2hlY2sgdGhhdCB3ZSBoYXZlIGltcGxlbWVudGVkIHRoZSB0cmFpdFxuSU1QTF9DT05DRVBUKENvdW50ZXIsIE15Q291bnRlcik7XG5cbi8vIEV4YW1wbGUgdXNhZ2UgdXNpbmcgY2xhc3NpYyBlbmFibGVfaWYgU0ZJTkFFXG50ZW1wbGF0ZSA8dHlwZW5hbWUgVD5cbnR5cGVuYW1lIHN0ZDo6ZW5hYmxlX2lmPFxuICAgIENvdW50ZXI6OmlzX2ltcGxlbWVudGVkX2J5PFQ%2BOjp2YWx1ZSxcbnZvaWQgPjo6dHlwZVxucHJpbnRfY291bnRlcihUJiBjb3VudGVyKSB7XG4gICAgc3RkOjpjb3V0IDw8IFwiQ291bnRlciB3aXRoIGNvdW50IFwiIDw8IGNvdW50ZXIuZ2V0X2NvdW50KCkgPDwgc3RkOjplbmRsO1xufVxuXG5pbnQgbWFpbigpIHtcbiAgICBNeUNvdW50ZXIgY291bnRlcjtcbiAgICBjb3VudGVyLmNvdW50ID0gMjU7XG4gICAgQ291bnRlcjo6Y2hlY2s8TXlDb3VudGVyPiB4O1xuICAgIHByaW50X2NvdW50ZXIoY291bnRlcik7XG59In1dfQ%3D%3D" target="_blank">&#x25B6;</a>
</div>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token comment">// Define the concept</span>
<span class="token keyword">struct</span> <span class="token class-name">Counter</span> <span class="token punctuation">{</span>
    <span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">></span>
    <span class="token keyword">struct</span> <span class="token class-name">is_implemented_by</span><span class="token operator">:</span> <span class="token base-clause">std<span class="token double-colon punctuation">::</span><span class="token class-name">false_type</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// Define the check</span>
    CONCEPT_CHECK_BEGIN
        <span class="token function">CONCEPT_ASSERT</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span> <span class="token keyword">int</span> <span class="token punctuation">(</span>Self<span class="token double-colon punctuation">::</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Self<span class="token double-colon punctuation">::</span>get_count<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">CONCEPT_ASSERT</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span> <span class="token keyword">void</span> <span class="token punctuation">(</span>Self<span class="token double-colon punctuation">::</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Self<span class="token double-colon punctuation">::</span>set_count<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">CONCEPT_ASSERT</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span> <span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Self<span class="token double-colon punctuation">::</span>max_count<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    CONCEPT_CHECK_END
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// ... skipping definition of struct MyCounter ...</span>
<span class="token comment">// Declare and check that we have implemented the trait</span>
<span class="token function">IMPL_CONCEPT</span><span class="token punctuation">(</span>Counter<span class="token punctuation">,</span> MyCounter<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>We can now use this for defining <code>print_count</code> using the same <code>enable_if</code> way we used previously. Also most of our macros are simple ones that dont require any parenthesis-escaping except <code>IMPL_CONCEPT</code>. Note these macros are completely optional in C++11.</p>
<details>
<summary>C++03 details and the macros</summary>
<p><code>BOOST_STATIC_ASSERT</code> can not take reference to a function (and <code>static_assert</code> is C++11)</p>
<pre><code>&lt;source&gt;:67:67: error: '&amp;' cannot appear in a constant-expression
   67 |         BOOST_STATIC_ASSERT(static_cast&lt; int (Self::*)() &gt;(&amp;Self::get_count));
</code></pre>
<p>We get around this by defining the <code>CONCEPT_ASSERT</code> macro expands an empty function in C++03, and the <code>CONCEPT_CHECK_BEGIN</code> defines the constructor of a <code>check&lt;Self&gt;</code> struct. This object is then internal-linkage-constructed by <code>IMPL_CONCEPT</code>. This ensures that the compiler tries to specialize the constructor with <code>Self</code> and detects that the <code>static_cast</code>s failed.</p>
<p>Note the <code>CONCEPT_ASSERT</code> macro should not be used for &quot;normal&quot;/non-method check asserts as it simply does nothing. Use say <code>BOOST_STATIC_ASSERT</code> otherwise.</p>
<p>See example preprocessor output <a href="https://godbolt.org/z/vn9eKr6G1">here</a></p>
<p>We can check the compile time error because <code>get_count</code> is commented out</p>
<ul>
<li><a href="https://godbolt.org/z/TY5ce3G9b">Gcc 4.9</a> (<a href="https://godbolt.org/z/oca3efas4">GCC 4.1.2</a>)</li>
<li><a href="https://godbolt.org/z/fnndG38cc">Clang 3.4</a></li>
<li><a href="https://godbolt.org/z/5xvnErG1v">MSVC 19.14 (2017 - new but oldest on godbolt)</a></li>
<li><a href="https://godbolt.org/z/M1oT6na4v">ICC 13.0.1 (2012)</a></li>
</ul>
</details>
<h2 id="aside-explicit-concepts-in-c-20" tabindex="-1">Aside: Explicit concepts in C++20 <a class="header-anchor" href="#aside-explicit-concepts-in-c-20">#</a></h2>
<p>Explicit concepts can be implemented in pretty much the same way in C++20, using a templated <code>is_counter</code> conditional struct</p>
<div class="code-play-button">
    <a href="https://godbolt.org/clientstate/eyJzZXNzaW9ucyI6W3siaWQiOjEsImxhbmd1YWdlIjoiYysrIiwiY29tcGlsZXJzIjpbeyJpZCI6ImcxMjEiLCJvcHRpb25zIjoiLXN0ZD1jKysyMCJ9XSwiZXhlY3V0b3JzIjpbeyJjb21waWxlciI6eyJpZCI6ImcxMjEiLCJvcHRpb25zIjoiLXN0ZD1jKysyMCJ9LCJjb21waWxlck91dHB1dFZpc2libGUiOiJ0cnVlIn1dLCJzb3VyY2UiOiIjaW5jbHVkZSA8aW9zdHJlYW0%2BXG4jaW5jbHVkZSA8Y29uY2VwdHM%2BXG4jaW5jbHVkZSA8dHlwZV90cmFpdHM%2BXG5cbi8vIEV4cGxpY2l0IGNoZWNrXG50ZW1wbGF0ZSA8dHlwZW5hbWUgU2VsZj5cbnN0cnVjdCBpc19jb3VudGVyOiBzdGQ6OmZhbHNlX3R5cGUge307XG5cbi8vIERlZmluZSB0aGUgY29uY2VwdCBjaGVja1xudGVtcGxhdGUgPHR5cGVuYW1lIFNlbGY%2BXG5jb25jZXB0IENvdW50ZXIgPVxuICAgIGlzX2NvdW50ZXI8U2VsZj46OnZhbHVlICYmICAgICAgICAgICAgICAgLy8gKiogTkVXICoqXG4gICAgcmVxdWlyZXMoU2VsZiBjb3VudGVyLCBpbnQgbmV3X2NvdW50KSB7ICAvLyAqKiBTQU1FIFNUVUZGICoqXG4gICAgICAgIHsgY291bnRlci5nZXRfY291bnQoKSB9IC0%2BIHN0ZDo6c2FtZV9hczxpbnQ%2BO1xuICAgICAgICB7IGNvdW50ZXIuc2V0X2NvdW50KG5ld19jb3VudCkgfSAtPiBzdGQ6OnNhbWVfYXM8dm9pZD47XG4gICAgICAgIHsgU2VsZjo6bWF4X2NvdW50KCkgfSAtPiBzdGQ6OnNhbWVfYXM8aW50PjtcbiAgICB9O1xuXG4vLyBPdXIgc3RydWN0XG5zdHJ1Y3QgTXlDb3VudGVyIHtcbiAgICBpbnQgY291bnQ7XG5cbiAgICBpbnQgZ2V0X2NvdW50KCkgeyByZXR1cm4gY291bnQ7IH1cbiAgICB2b2lkIHNldF9jb3VudChpbnQgbmV3X2NvdW50KSB7IGNvdW50ID0gbmV3X2NvdW50OyB9XG4gICAgc3RhdGljIGludCBtYXhfY291bnQoKSB7IHJldHVybiAxMDA7IH1cbn07XG4vLyAuLi4gc2tpcHBpbmcgZGVmaW5pdGlvbiBvZiBzdHJ1Y3QgTXlDb3VudGVyIC4uLlxuLy8gRGVjbGFyZSBhbmQgY2hlY2sgdGhhdCB3ZSBoYXZlIGltcGxlbWVudGVkIHRoZSB0cmFpdFxudGVtcGxhdGUgPD4gc3RydWN0IGlzX2NvdW50ZXI8TXlDb3VudGVyPiA6IHN0ZDo6dHJ1ZV90eXBlIHt9O1xuc3RhdGljX2Fzc2VydChDb3VudGVyPE15Q291bnRlcj4pOyAvLyBvcHRpb25hbGx5IGNoZWNrIGltcGxlbWVudGF0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmIHdlIGZvcmdvdCBhbnkgbWV0aG9kcywgZXRjLi4uXG5cbi8vIEV4YW1wbGUgdXNhZ2VcbnRlbXBsYXRlIDx0eXBlbmFtZSBUPlxucmVxdWlyZXMgQ291bnRlcjxUPlxudm9pZCBwcmludF9jb3VudGVyKFQmIGNvdW50ZXIpIHtcbiAgICAvLyBDYW4gYWxzbyB1c2Ugc2hvcnRoYW5kIGB0ZW1wbGF0ZSA8Q291bnRlciBUPmAgaW5zdGVhZCBvZiBgcmVxdWlyZXNgIGNsYXVzZVxuICAgIHN0ZDo6Y291dCA8PCBcIkNvdW50ZXIgd2l0aCBjb3VudCBcIiA8PCBjb3VudGVyLmdldF9jb3VudCgpIDw8IHN0ZDo6ZW5kbDtcbn1cblxuaW50IG1haW4oKSB7XG4gICAgTXlDb3VudGVyIGMgeyAyNSB9O1xuICAgIHByaW50X2NvdW50ZXIoYyk7XG59In1dfQ%3D%3D" target="_blank">&#x25B6;</a>
</div>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token comment">// Explicit check</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">Self</span><span class="token operator">></span>
<span class="token keyword">struct</span> <span class="token class-name">is_counter</span><span class="token operator">:</span> <span class="token base-clause">std<span class="token double-colon punctuation">::</span><span class="token class-name">false_type</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Define the concept check</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">Self</span><span class="token operator">></span>
<span class="token keyword">concept</span> <span class="token class-name">Counter</span> <span class="token operator">=</span>
    is_counter<span class="token operator">&lt;</span>Self<span class="token operator">></span><span class="token double-colon punctuation">::</span>value <span class="token operator">&amp;&amp;</span>               <span class="token comment">// ** NEW **</span>
    <span class="token keyword">requires</span><span class="token punctuation">(</span>Self counter<span class="token punctuation">,</span> <span class="token keyword">int</span> new_count<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// ** SAME STUFF **</span>
        <span class="token punctuation">{</span> counter<span class="token punctuation">.</span><span class="token function">get_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token operator">-></span> std<span class="token double-colon punctuation">::</span>same_as<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token punctuation">;</span>
        <span class="token punctuation">{</span> counter<span class="token punctuation">.</span><span class="token function">set_count</span><span class="token punctuation">(</span>new_count<span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token operator">-></span> std<span class="token double-colon punctuation">::</span>same_as<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">></span><span class="token punctuation">;</span>
        <span class="token punctuation">{</span> <span class="token class-name">Self</span><span class="token double-colon punctuation">::</span><span class="token function">max_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token operator">-></span> std<span class="token double-colon punctuation">::</span>same_as<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// ... skipping definition of struct MyCounter ...</span>
<span class="token comment">// Declare and check that we have implemented the trait</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token operator">></span> <span class="token keyword">struct</span> <span class="token class-name">is_counter</span><span class="token operator">&lt;</span>MyCounter<span class="token operator">></span> <span class="token operator">:</span> std<span class="token double-colon punctuation">::</span>true_type <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">static_assert</span><span class="token punctuation">(</span>Counter<span class="token operator">&lt;</span>MyCounter<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// optionally check implementation</span>
                                   <span class="token comment">// if we forgot any methods, etc...</span></code></pre>
<h2 id="rant-on-c-20-concepts" tabindex="-1">Rant on C++20 Concepts <a class="header-anchor" href="#rant-on-c-20-concepts">#</a></h2>
<p>C++20 Concepts thus allow for powerful implicit matching. But, let us take the following example:</p>
<blockquote>
<p>Lets say we are building some kind of social media stats app and we have <code>youtube_api::VideoViewCounter</code> and <code>instagram_api::LikeCounter</code>. Both of them have the <code>get_count</code> method.</p>
<p>We want to define a <code>print_count(counter)</code> method which takes either of these two classes and does <code>std::cout &lt;&lt; counter.get_count()</code>.</p>
</blockquote>
<p>We do not have control over either APIs, but would like a common abstraction. We can:</p>
<ol>
<li>Declare an &quot;implicit concept&quot; called <code>Counter</code> which requires a <code>get_count</code> method. Define templated <code>print_count</code> for concept</li>
<li>Declare an &quot;explicit concept&quot; with the same. Specify that the above two classes implement this concept without modying the classes. Define templated <code>print_count</code> for concept.</li>
<li>Use an unchecked templated <code>print_count</code></li>
</ol>
<p>Now consider the following modification to the codebase:</p>
<blockquote>
<p>We add class <code>my_shared_ptr</code> which has <code>get_count</code> method which returns the reference count of the pointer.</p>
<p>Lets say another engineer started refactoring to store the objects in <code>shared_ptr</code> but <code>print_counter</code> has not been modified for an explicit overload for <code>shared_ptr</code></p>
<p>What happens when we call <code>print_count(counter_ptr)</code> with <code>counter_ptr = my_shared_ptr&lt;youtube_api::VideoViewCounter&gt;()</code>?</p>
</blockquote>
<p>Note that:</p>
<ol>
<li>In the case of &quot;implicit concepts&quot;, we would see the reference count being printed, without any compile or run-time error.</li>
<li>In the case of &quot;explicit concepts&quot;, we would get a compile time error since no method matches this.</li>
<li>In the case of an unchecked template too, we would see the reference count being printed too.</li>
</ol>
<p>Thus, <em>implicit concepts are almost as bad as not having any check at all</em>. Except maybe they can produce neater compiler errors (ignoring the case of overloading based on concepts).</p>
<p>Even if you had a 1000 different classes, writing 1000 more lines saying that a concept is implemented by them is better than implicit behaviour in my opinion. In most cases you will either have 1000 template specializations or some script generated code, and in both cases you only need to add one line.</p>
<blockquote>
<p>What regex is to parsing, implicit concepts are to C++.</p>
</blockquote>
<p>And if explicit concepts are better and already implementable in C++03, why provide an abstraction where most developers will write error-prone code instead of providing syntax sugar for explicit concepts?</p>
<h2 id="extra-syntactic-sugar-stuff" tabindex="-1">Extra syntactic sugar stuff <a class="header-anchor" href="#extra-syntactic-sugar-stuff">#</a></h2>
<ul>
<li>
<p>Using C++20 Concepts with C++03 concepts</p>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">Self</span><span class="token operator">></span>
<span class="token keyword">concept</span> <span class="token class-name">Counter_</span> <span class="token operator">=</span> Counter<span class="token double-colon punctuation">::</span>is_implemented_by<span class="token operator">&lt;</span>Self<span class="token operator">></span><span class="token double-colon punctuation">::</span>value<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">print_counter</span><span class="token punctuation">(</span>Counter_ <span class="token keyword">auto</span> counter<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span></code></pre>
</li>
<li>
<p>Requiring multiple C++03 Concepts to be satisfied</p>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">Self</span><span class="token punctuation">,</span> <span class="token keyword">typename</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> Trait<span class="token operator">></span>
<span class="token keyword">struct</span> <span class="token class-name">require_concepts</span><span class="token operator">:</span> <span class="token base-clause">std<span class="token double-colon punctuation">::</span><span class="token class-name">conjunction</span><span class="token operator">&lt;</span> Trait<span class="token double-colon punctuation">::</span><span class="token class-name">is_implemented_by</span><span class="token operator">&lt;</span><span class="token class-name">Self</span><span class="token operator">></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token operator">></span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

USE AS std<span class="token double-colon punctuation">::</span>enable_if<span class="token operator">&lt;</span>require_concepts<span class="token operator">&lt;</span>Cls<span class="token punctuation">,</span> Concept1<span class="token punctuation">,</span> Concept2<span class="token operator">>></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre>
</li>
<li>
<p>Composing concepts - Using other concept checks in a check (slightly leaky abstraction for C++03)</p>
<pre class="language-cpp" tabindex="0"><code class="language-cpp">CONCEPT_CHECK_BEGIN
  <span class="token comment">// Require other_concept to be implemented</span>
  <span class="token function">BOOST_STATIC_ASSERT</span><span class="token punctuation">(</span>other_concept<span class="token double-colon punctuation">::</span>is_implemented_by<span class="token operator">&lt;</span>Self<span class="token operator">></span><span class="token double-colon punctuation">::</span>value<span class="token punctuation">)</span>
  <span class="token comment">// Require either_concept1 or or_concept to be implemented</span>
  <span class="token function">BOOST_STATIC_ASSERT</span><span class="token punctuation">(</span>either_concept1<span class="token double-colon punctuation">::</span>is_implemented_by<span class="token operator">&lt;</span>Self<span class="token operator">></span><span class="token double-colon punctuation">::</span>value <span class="token operator">||</span> or_concept2<span class="token double-colon punctuation">::</span>is_implemented_by<span class="token operator">&lt;</span>Self<span class="token operator">></span><span class="token double-colon punctuation">::</span>value<span class="token punctuation">)</span>
CONCEPT_CHECK_END</code></pre>
</li>
</ul>
<h2 id="summary" tabindex="-1">Summary <a class="header-anchor" href="#summary">#</a></h2>
<p>We saw what C++ concepts were and how to write &quot;explicit concepts&quot; in C++03. We also noted that C++20 implicit concepts are error-prone.</p>
<p>In the next post I will describe how this compares to Rust traits and how to implement &quot;trait objects&quot; or &quot;concept maps&quot; using the same code.</p>
<p><strong>NOTE</strong>: For any of the &quot;predefined concepts&quot; like say <code>copy_constructible</code>, <code>type_traits</code> or similar Boost/utility library can be used.</p>

<ul class="links-nextprev"><li>Previous: <a href="/blog/posts/gsoc-summary/">GSoC Summary</a></li><li>Next: <a href="/blog/posts/c++-force-inline/">Force Inline in C++</a></li>
<li>Discuss on:

&nbsp;<a href="https://news.ycombinator.com/item?id=32356522" target="_blank">hackernews</a>

&nbsp;<a href="https://www.reddit.com/r/cpp/comments/wgxjzy/c20_concepts_in_c03/" target="_blank">reddit</a>

</li>
</ul>


<script src="/blog/js/index.js"></script>
<script src="https://utteranc.es/client.js" repo="meghprkh/blog" issue-term="pathname" label="comments" theme="preferred-color-scheme" crossorigin="anonymous" async="">
</script>


		</main>

		<footer></footer>

		<!-- This page `/blog/posts/c++03-concepts/` was built on 2025-04-30T06:22:10.270Z -->
	</body>

	<script data-goatcounter="https://meghprkh.goatcounter.com/count" async="" src="//gc.zgo.at/count.js"></script>
	<noscript>
		<img src="https://meghprkh.goatcounter.com/count?p=/blog/blog/posts/c++03-concepts/?noscript">
	</noscript>
</html>
