<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Rust Traits - Associated Types and Generic Traits</title>
		<meta name="description" content="Ramblings and dumb ideas">
		<link rel="alternate" href="/blog/feed/feed.xml" type="application/atom+xml" title="Megh&#39;s Blog">
		<link rel="alternate" href="/blog/feed/feed.json" type="application/json" title="Megh&#39;s Blog">
		
		<style>/**
 * okaidia theme for JavaScript, CSS and HTML
 * Loosely based on Monokai textmate theme by http://www.monokai.nl/
 * @author ocodia
 */

code[class*="language-"],
pre[class*="language-"] {
	color: #f8f8f2;
	background: none;
	text-shadow: 0 1px rgba(0, 0, 0, 0.3);
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
	border-radius: 0.3em;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #272822;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: #8292a2;
}

.token.punctuation {
	color: #f8f8f2;
}

.token.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.constant,
.token.symbol,
.token.deleted {
	color: #f92672;
}

.token.boolean,
.token.number {
	color: #ae81ff;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #a6e22e;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string,
.token.variable {
	color: #f8f8f2;
}

.token.atrule,
.token.attr-value,
.token.function,
.token.class-name {
	color: #e6db74;
}

.token.keyword {
	color: #66d9ef;
}

.token.regex,
.token.important {
	color: #fd971f;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
/*
 * New diff- syntax
 */

pre[class*="language-diff-"] {
	--eleventy-code-padding: 1.25em;
	padding-left: var(--eleventy-code-padding);
	padding-right: var(--eleventy-code-padding);
}
.token.deleted {
	background-color: hsl(0, 51%, 37%);
	color: inherit;
}
.token.inserted {
	background-color: hsl(126, 31%, 39%);
	color: inherit;
}

/* Make the + and - characters unselectable for copy/paste */
.token.prefix.unchanged,
.token.prefix.inserted,
.token.prefix.deleted {
	-webkit-user-select: none;
	user-select: none;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	padding-top: 2px;
	padding-bottom: 2px;
}
.token.prefix.inserted,
.token.prefix.deleted {
	width: var(--eleventy-code-padding);
	background-color: rgba(0, 0, 0, 0.2);
}

/* Optional: full-width background color */
.token.inserted:not(.prefix),
.token.deleted:not(.prefix) {
	display: block;
	margin-left: calc(-1 * var(--eleventy-code-padding));
	margin-right: calc(-1 * var(--eleventy-code-padding));
	text-decoration: none; /* override del, ins, mark defaults */
	color: inherit; /* override del, ins, mark defaults */
}
* { box-sizing: border-box; }
/* Defaults */
:root {
	--font-family: -apple-system, system-ui, sans-serif;
	--font-family-monospace:
		Consolas, Menlo, Monaco, Andale Mono WT, Andale Mono, Lucida Console,
		Lucida Sans Typewriter, DejaVu Sans Mono, Bitstream Vera Sans Mono,
		Liberation Mono, Nimbus Mono L, Courier New, Courier, monospace;
}

/* Theme colors */
:root {
	--color-gray-20: #e0e0e0;
	--color-gray-50: #c0c0c0;
	--color-gray-90: #333;

	--background-color: #fff;

	--text-color: var(--color-gray-90);
	--text-color-link: #082840;
	--text-color-link-active: #5f2b48;
	--text-color-link-visited: #17050f;

	--syntax-tab-size: 2;
}

@media (prefers-color-scheme: dark) {
	:root {
		--color-gray-20: #e0e0e0;
		--color-gray-50: #c0c0c0;
		--color-gray-90: #dad8d8;

		/* --text-color is assigned to --color-gray-_ above */
		--text-color-link: #1493fb;
		--text-color-link-active: #6969f7;
		--text-color-link-visited: #a6a6f8;

		--background-color: #15202b;
	}
}

/* Global stylesheet */
* {
	box-sizing: border-box;
}

html,
body {
	padding: 0;
	margin: 0 auto;
	font-family: var(--font-family);
	color: var(--text-color);
	background-color: var(--background-color);
}
html {
	overflow-y: scroll;
}
body {
	max-width: 50em;
}

/* https://www.a11yproject.com/posts/how-to-hide-content/ */
.visually-hidden {
	clip: rect(0 0 0 0);
	clip-path: inset(50%);
	height: 1px;
	overflow: hidden;
	position: absolute;
	white-space: nowrap;
	width: 1px;
}

p:last-child {
	margin-bottom: 0;
}
p {
	line-height: 1.5;
}

li {
	line-height: 1.5;
}

a[href] {
	color: var(--text-color-link);
}
a[href]:visited {
	color: var(--text-color-link-visited);
}
a[href]:hover,
a[href]:active {
	color: var(--text-color-link-active);
}

main {
	padding: 1rem;
}
main :first-child {
	margin-top: 0;
}

header {
	border-bottom: 1px dashed var(--color-gray-20);
}
header:after {
	content: "";
	display: table;
	clear: both;
}

.links-nextprev {
	list-style: none;
	border-top: 1px dashed var(--color-gray-20);
	padding: 1em 0;
}

table {
	margin: 1em 0;
}
table td,
table th {
	padding-right: 1em;
}

pre,
code,
code[class*="language-"],
pre[class*="language-"] {
	font-family: var(--font-family-monospace);
	font-size: 0.95em;
	line-height: 1.5;
}
pre:not([class*="language-"]) {
	background: #272822;
	padding: 1em;
	margin: 0.5em 0;
	overflow: auto;
	line-height: 1.375; /* 22px /16 */
	-moz-tab-size: var(--syntax-tab-size);
	-o-tab-size: var(--syntax-tab-size);
	tab-size: var(--syntax-tab-size);
	-webkit-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
	direction: ltr;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
}
code {
	word-break: break-all;
}

/* Header */
header {
	display: flex;
	gap: 1em 0.5em;
	flex-wrap: wrap;
	align-items: center;
	padding: 1em;
}
.home-link {
	font-size: 1em; /* 16px /16 */
	font-weight: 700;
	margin-right: 2em;
}
.home-link:link:not(:hover) {
	text-decoration: none;
}

/* Nav */
.nav {
	display: flex;
	padding: 0;
	margin: 0;
	list-style: none;
}
.nav-item {
	display: inline-block;
	margin-right: 1em;
}
.nav-item a[href]:not(:hover) {
	text-decoration: none;
}
.nav a[href][aria-current="page"] {
	text-decoration: underline;
}

/* Posts list */
.postlist {
	list-style: none;
	padding: 0;
	padding-left: 1.5rem;
}
.postlist-item {
	display: flex;
	flex-wrap: wrap;
	align-items: baseline;
	counter-increment: start-from -1;
	margin-bottom: 1em;
}
.postlist-item:before {
	display: inline-block;
	pointer-events: none;
	content: "" counter(start-from, decimal-leading-zero) ". ";
	line-height: 100%;
	text-align: right;
	margin-left: -1.5rem;
}
.postlist-date,
.postlist-item:before {
	font-size: 0.8125em; /* 13px /16 */
	color: var(--color-gray-90);
}
.postlist-date {
	word-spacing: -0.5px;
}
.postlist-link {
	font-size: 1.1875em; /* 19px /16 */
	font-weight: 700;
	flex-basis: calc(100% - 1.5rem);
	padding-left: 0.25em;
	padding-right: 0.5em;
	text-underline-position: from-font;
	text-underline-offset: 0;
	text-decoration-thickness: 1px;
}
.postlist-item-active .postlist-link {
	font-weight: bold;
}

/* Tags */
.post-tag {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	text-transform: capitalize;
	font-style: italic;
}
.postlist-item > .post-tag {
	align-self: center;
}

/* Tags list */
.post-metadata {
	display: inline-flex;
	flex-wrap: wrap;
	gap: 0.5em;
	list-style: none;
	padding: 0;
	margin: 0;
}
.post-metadata time {
	margin-right: 1em;
}

/* Direct Links / Markdown Headers */
.header-anchor {
	text-decoration: none;
	font-style: normal;
	font-size: 1em;
	margin-left: 0.1em;
}
a[href].header-anchor,
a[href].header-anchor:visited {
	color: transparent;
}
a[href].header-anchor:focus,
a[href].header-anchor:hover {
	text-decoration: underline;
}
a[href].header-anchor:focus,
:hover > a[href].header-anchor {
	color: #aaa;
}

h2 + .header-anchor {
	font-size: 1.5em;
}

/* Modified */
table,
th,
td {
	border: 1px solid;
	padding: 0.5em;
}

table {
	width: 100%;
	border-collapse: collapse;
}

/* Table of Contents */
#TableOfContents {
	margin: 1em 0em;
}
#TableOfContents > nav > ol::before {
	content: "Table of Contents";
	font-weight: bold;
	text-align: center;
	display: block;
	margin-left: -1.25em;
}

#TableOfContents > nav > ol {
	border: 1px dashed var(--color-gray-90);
	padding: 0.75em 0.75em 0.75em 2em;
}

#TableOfContents .active {
	color: var(--text-color-link-active);
}

@media (min-width: 80em) {
	#TableOfContents {
		display: block;
		width: calc(50vw - 29em);
		max-width: 20em;
		position: -webkit-sticky;
		position: sticky;
		height: 0;
		top: 3.5em;
		margin: 0em;
		margin-left: 52em;
		background: none;
	}
}

/* Misc */
.code-play-button {
	position: relative;
}

.code-play-button a {
	position: absolute;
	text-decoration: none;
	right: 0em;
	width: 1.25em;
	display: inline-block;
	font-size: 1.5em;
	color: white;
	content: "\25B6";
}</style>
	</head>
	<body>
		<a href="#skip" class="visually-hidden">Skip to main content</a>

		<header>
			<a href="/blog/" class="home-link">Megh&#39;s Blog</a>
			<nav>
				<h2 class="visually-hidden">Top level navigation menu</h2>
				<ul class="nav">
					<li class="nav-item"><a href="/blog/">Home</a></li>
					<li class="nav-item"><a href="/blog/archive/">Archive</a></li>
					<li class="nav-item"><a href="/blog/about/">About Me</a></li>
					<li class="nav-item"><a href="https://meghprkh.github.io/">Portfolio</a></li>
				</ul>
			</nav>
		</header>

		<main id="skip">
			
<h1>Rust Traits - Associated Types and Generic Traits</h1>

<ul class="post-metadata">
	<li><time datetime="2025-04-05">05 April 2025</time></li>
	<li><a href="/blog/tags/rust/" class="post-tag">Rust</a>, </li>
	<li><a href="/blog/tags/traits/" class="post-tag">Traits</a>, </li>
	<li><a href="/blog/tags/typeclasses/" class="post-tag">Typeclasses</a></li>
</ul>

<aside id="TableOfContents">
  <nav class="toc">
        <ol><li><a href="#are-both-features-needed">Are both features needed?</a></li><li><a href="#trait-inferring-works-even-for-generic-traits">Trait inferring - works even for generic traits</a></li><li><a href="#uniqueness-constraint">Uniqueness constraint</a></li><li><a href="#more-differences-returning-trait-objects">More differences - returning trait objects</a></li><li><a href="#more-differences-multiple-associated-types">More differences - multiple associated types</a></li><li><a href="#my-mental-model">My mental model</a></li></ol>
      </nav>
</aside>
<p>Rust's traits have a nifty feature called <a href="https://doc.rust-lang.org/stable/book/ch20-02-advanced-traits.html#specifying-placeholder-types-in-trait-definitions-with-associated-types">Associated Types</a>. Rust's traits can also have <a href="https://doc.rust-lang.org/stable/book/ch20-02-advanced-traits.html#default-generic-type-parameters-and-operator-overloading">Generic Type Parameters</a>.</p>
<p>This post delves into some differences between the two, whether both are needed and my mental model of these concepts.</p>
<p>I am not a Rust pro, and came across this while relearning traits. Please let me know your comments!</p>
<!-- more -->
<h2 id="are-both-features-needed" tabindex="-1">Are both features needed? <a class="header-anchor" href="#are-both-features-needed">#</a></h2>
<p>The Rust book itself asks this question:</p>
<blockquote>
<p>Associated types might seem like a similar concept to generics, in that the latter allow us to define a function without specifying what types it can
handle. To examine the difference between the two concepts, weâ€™ll look at an implementation of the Iterator trait on a type named Counter that
specifies the Item type is u32:</p>
<pre class="language-rust" tabindex="0"><code class="language-rust"><span class="token keyword">impl</span> <span class="token class-name">Iterator</span> <span class="token keyword">for</span> <span class="token class-name">Counter</span> <span class="token punctuation">{</span>
    <span class="token keyword">type</span> <span class="token type-definition class-name">Item</span> <span class="token operator">=</span> <span class="token keyword">u32</span><span class="token punctuation">;</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">next</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">Item</span><span class="token operator">></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>This syntax seems comparable to that of generics. So why not just define the Iterator trait with generics, as shown in Listing 20-14?</p>
<pre class="language-rust" tabindex="0"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">trait</span> <span class="token type-definition class-name">Iterator</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token punctuation">{</span>
   <span class="token keyword">fn</span> <span class="token function-definition function">next</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p><cite><a href="https://doc.rust-lang.org/stable/book/ch20-02-advanced-traits.html#specifying-placeholder-types-in-trait-definitions-with-associated-types">(From the Rust Book)</a></cite></p>
</blockquote>
<p>It further states that</p>
<blockquote>
<p>The difference is that when using generics, as in Listing 20-14, we must annotate the types in each implementation; because we can also implement Iterator<String> for Counter or any other type, we could have multiple implementations of Iterator for Counter. In other words, when a trait has a generic parameter, it can be implemented for a type multiple times, changing the concrete types of the generic type parameters each time. When we use the next method on Counter, we would have to provide type annotations to indicate which implementation of Iterator we want to use.</String></p>
<p><cite>(From the Rust Book)</cite></p>
</blockquote>
<h2 id="trait-inferring-works-even-for-generic-traits" tabindex="-1">Trait inferring - works even for generic traits <a class="header-anchor" href="#trait-inferring-works-even-for-generic-traits">#</a></h2>
<p>Part of the above statement is is not true. The following works without explicit qualification of the trait:</p>
<div class="code-play-button">
    <a href="https://godbolt.org/clientstate/eyJzZXNzaW9ucyI6W3siaWQiOjEsImxhbmd1YWdlIjoicnVzdCIsImNvbXBpbGVycyI6W3siaWQiOiJyMTYyMCJ9XSwiZXhlY3V0b3JzIjpbeyJjb21waWxlciI6eyJpZCI6InIxNjIwIn0sImNvbXBpbGVyT3V0cHV0VmlzaWJsZSI6InRydWUifV0sInNvdXJjZSI6InRyYWl0IE15VHJhaXQ8VD4ge1xuICAgIGZuIGZpcnN0X2VsZW1lbnQoJnNlbGYpIC0%2BIE9wdGlvbjxUPjtcbn1cbmltcGwgTXlUcmFpdDxpNjQ%2BIGZvciBWZWM8aTY0PiB7XG4gICAgZm4gZmlyc3RfZWxlbWVudCgmc2VsZikgLT4gT3B0aW9uPGk2ND4geyBOb25lIH1cbn1cbmZuIG1haW4oKSB7XG4gICAgbGV0IHYgPSB2ZWMhWzEsIDIsIDNdO1xuICAgIHByaW50bG4hKFwiezo%2FfVwiLCB2LmZpcnN0X2VsZW1lbnQoKSk7XG59In1dfQ%3D%3D" target="_blank">&#x25B6;</a>
</div>
<pre class="language-rust" tabindex="0"><code class="language-rust"><span class="token keyword">trait</span> <span class="token type-definition class-name">MyTrait</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">first_element</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">impl</span> <span class="token class-name">MyTrait</span><span class="token operator">&lt;</span><span class="token keyword">i64</span><span class="token operator">></span> <span class="token keyword">for</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">i64</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">first_element</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">i64</span><span class="token operator">></span> <span class="token punctuation">{</span> <span class="token class-name">None</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> v<span class="token punctuation">.</span><span class="token function">first_element</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>Thus if you have a generic type, and only one implementation of it, Rust is able to do a name-based lookup for it. This is similar to how it does name-based lookup for traits in the first place, i.e. on noticing <code>v.first_element()</code>, it:</p>
<ol>
<li>Analyzes the type of the object the method is being called on, i.e. <code>v</code> -&gt; <code>Vec&lt;i64&gt;</code></li>
<li>List traits implemented for it, i.e. <code>Index, MyTrait</code> and so on</li>
<li>See if any of them have the matching method call, i.e. <code>first_element()</code></li>
<li>If there are multiple matches, error out with an ambiguous match error</li>
</ol>
<h2 id="uniqueness-constraint" tabindex="-1">Uniqueness constraint <a class="header-anchor" href="#uniqueness-constraint">#</a></h2>
<p>However, with associated types, the useful contract that a trait can only be implemented once for a type remains. I.e, the following is possible with generic traits but not with associated types.</p>
<div class="code-play-button">
    <a href="https://godbolt.org/clientstate/eyJzZXNzaW9ucyI6W3siaWQiOjEsImxhbmd1YWdlIjoicnVzdCIsImNvbXBpbGVycyI6W3siaWQiOiJyMTYyMCJ9XSwiZXhlY3V0b3JzIjpbeyJjb21waWxlciI6eyJpZCI6InIxNjIwIn0sImNvbXBpbGVyT3V0cHV0VmlzaWJsZSI6InRydWUifV0sInNvdXJjZSI6InRyYWl0IE15VHJhaXQ8VD4ge1xuICAgIGZuIGZpcnN0X2VsZW1lbnQoJnNlbGYpIC0%2BIE9wdGlvbjxUPjtcbn1cbmltcGwgTXlUcmFpdDxpNjQ%2BIGZvciBWZWM8aTY0PiB7XG4gICAgZm4gZmlyc3RfZWxlbWVudCgmc2VsZikgLT4gT3B0aW9uPGk2ND4geyBOb25lIH1cbn1cbmltcGwgTXlUcmFpdDx1NjQ%2BIGZvciBWZWM8aTY0PiB7XG4gICAgZm4gZmlyc3RfZWxlbWVudCgmc2VsZikgLT4gT3B0aW9uPHU2ND4geyBOb25lIH1cbn1cbmZuIG1haW4oKSB7XG4gICAgbGV0IHYgPSB2ZWMhWzEsIDIsIDNdO1xuLy8gTmVlZCB0byBkaXNhbWJpZ3VhdGUgdGhlIHRyYWl0IHRvIGJlIGNhbGxlZFxucHJpbnRsbiEoXCJ7Oj99XCIsIE15VHJhaXQ6OjxpNjQ%2BOjpmaXJzdF9lbGVtZW50KCZ2KSk7XG59In1dfQ%3D%3D" target="_blank">&#x25B6;</a>
</div>
<pre class="language-rust" tabindex="0"><code class="language-rust"><span class="token keyword">impl</span> <span class="token class-name">MyTrait</span><span class="token operator">&lt;</span><span class="token keyword">i64</span><span class="token operator">></span> <span class="token keyword">for</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">i64</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">first_element</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">i64</span><span class="token operator">></span> <span class="token punctuation">{</span> <span class="token class-name">None</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">impl</span> <span class="token class-name">MyTrait</span><span class="token operator">&lt;</span><span class="token keyword">u64</span><span class="token operator">></span> <span class="token keyword">for</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">i64</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">first_element</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">u64</span><span class="token operator">></span> <span class="token punctuation">{</span> <span class="token class-name">None</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// Need to disambiguate the trait to be called</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> <span class="token class-name">MyTrait</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token keyword">i64</span><span class="token operator">></span><span class="token punctuation">::</span><span class="token function">first_element</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>So, are there other differences?</p>
<h2 id="more-differences-returning-trait-objects" tabindex="-1">More differences - returning trait objects <a class="header-anchor" href="#more-differences-returning-trait-objects">#</a></h2>
<p>Let's assume we want to define <code>vec_iter</code> which wraps <code>vec.iter()</code> such that we can</p>
<pre class="language-rust" tabindex="0"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token function">vec_iter</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>In the case of associated types, we can specify the trait without specifying the associated type.</p>
<div class="code-play-button">
    <a href="https://godbolt.org/clientstate/eyJzZXNzaW9ucyI6W3siaWQiOjEsImxhbmd1YWdlIjoicnVzdCIsImNvbXBpbGVycyI6W3siaWQiOiJyMTYyMCJ9XSwiZXhlY3V0b3JzIjpbeyJjb21waWxlciI6eyJpZCI6InIxNjIwIn0sImNvbXBpbGVyT3V0cHV0VmlzaWJsZSI6InRydWUifV0sInNvdXJjZSI6Ii8vIFZhbGlkIHRvIG9ubHkgc3BlY2lmeSBJdGVyYXRvciB3aXRob3V0IGl0cyBhc3NvY2lhdGVkIHR5cGUgSXRlbVxuZm4gdmVjX2l0ZXIoeDogJlZlYzxpNjQ%2BKSAtPiBpbXBsIEl0ZXJhdG9yICsgJ18geyB4Lml0ZXIoKSB9XG5mbiBtYWluKCkge1xuICAgIGxldCB2ID0gdmVjIVsxLCAyLCAzXTtcbi8vIFZhbGlkIHRvIGNhbGwgdGhpc1xubGV0IF8gPSB2ZWNfaXRlcih2KTtcbn0ifV19" target="_blank">&#x25B6;</a>
</div>
<pre class="language-rust" tabindex="0"><code class="language-rust"><span class="token comment">// Valid to only specify Iterator without its associated type Item</span>
<span class="token keyword">fn</span> <span class="token function-definition function">vec_iter</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">i64</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">impl</span> <span class="token class-name">Iterator</span> <span class="token operator">+</span> <span class="token lifetime-annotation symbol">'_</span> <span class="token punctuation">{</span> x<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token comment">// Valid to call this</span>
<span class="token keyword">let</span> _ <span class="token operator">=</span> <span class="token function">vec_iter</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>This itself is not very useful in most cases, as using it would have caused an error</p>
<div class="code-play-button">
    <a href="https://godbolt.org/clientstate/eyJzZXNzaW9ucyI6W3siaWQiOjEsImxhbmd1YWdlIjoicnVzdCIsImNvbXBpbGVycyI6W3siaWQiOiJyMTYyMCJ9XSwiZXhlY3V0b3JzIjpbeyJjb21waWxlciI6eyJpZCI6InIxNjIwIn0sImNvbXBpbGVyT3V0cHV0VmlzaWJsZSI6InRydWUifV0sInNvdXJjZSI6Ii8vIFZhbGlkIHRvIG9ubHkgc3BlY2lmeSBJdGVyYXRvciB3aXRob3V0IGl0cyBhc3NvY2lhdGVkIHR5cGUgSXRlbVxuZm4gdmVjX2l0ZXIoeDogJlZlYzxpNjQ%2BKSAtPiBpbXBsIEl0ZXJhdG9yICsgJ18geyB4Lml0ZXIoKSB9XG5mbiBtYWluKCkge1xuICAgIGxldCB2ID0gdmVjIVsxLCAyLCAzXTtcblxuLy8gSW52YWxpZCBhcyB0eXBlIG9mIHggaXMgXCJvcGFxdWVcIlxuZm9yIHggaW4gdmVjX2l0ZXIoJnYpIHtcbiAgICBwcmludGxuIShcInt9XCIsIHgpO1xuICAgIC8vIF4gZXJyb3JbRTAyNzddOiBgPGltcGwgSXRlcmF0b3IgYXMgSXRlcmF0b3I%2BOjpJdGVtYCBkb2Vzbid0IGltcGxlbWVudCBgc3RkOjpmbXQ6OkRpc3BsYXlgXG59XG59In1dfQ%3D%3D" target="_blank">&#x25B6;</a>
</div>
<pre class="language-rust" tabindex="0"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">vec_iter</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">i64</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">impl</span> <span class="token class-name">Iterator</span> <span class="token operator">+</span> <span class="token lifetime-annotation symbol">'_</span> <span class="token punctuation">{</span> x<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>

<span class="token comment">// Invalid as type of x is "opaque"</span>
<span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token function">vec_iter</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ^ error[E0277]: `&lt;impl Iterator as Iterator>::Item` doesn't implement `std::fmt::Display`</span>
<span class="token punctuation">}</span></code></pre>
<p>Returning a dyn of a trait is invalid when associated types are not specified</p>
<div class="code-play-button">
    <a href="https://godbolt.org/clientstate/eyJzZXNzaW9ucyI6W3siaWQiOjEsImxhbmd1YWdlIjoicnVzdCIsImNvbXBpbGVycyI6W3siaWQiOiJyMTYyMCJ9XSwiZXhlY3V0b3JzIjpbeyJjb21waWxlciI6eyJpZCI6InIxNjIwIn0sImNvbXBpbGVyT3V0cHV0VmlzaWJsZSI6InRydWUifV0sInNvdXJjZSI6Ii8vIFZhbGlkIHRvIG9ubHkgc3BlY2lmeSBJdGVyYXRvciB3aXRob3V0IGl0cyBhc3NvY2lhdGVkIHR5cGUgSXRlbVxuZm4gdmVjX2l0ZXIoeDogJlZlYzxpNjQ%2BKSAtPiBkeW4gSXRlcmF0b3IgeyB4Lml0ZXIoKSB9XG4vLyBlcnJvcltFMDE5MV06IHRoZSB2YWx1ZSBvZiB0aGUgYXNzb2NpYXRlZCB0eXBlIGBJdGVtYCAoZnJvbSB0cmFpdCBgSXRlcmF0b3JgKSBtdXN0IGJlIHNwZWNpZmllZFxuZm4gbWFpbigpIHtcbiAgICBsZXQgdiA9IHZlYyFbMSwgMiwgM107XG4vLyBmcmFnbWVudCByZXR1cm5faXRlcmF0b3Jcbi8vIEludmFsaWQgYXMgdHlwZSBvZiB4IGlzIFwib3BhcXVlXCJcbmZvciB4IGluIHZlY19pdGVyKCZ2KSB7XG4gICAgcHJpbnRsbiEoXCJ7fVwiLCB4KTtcbiAgICAvLyBeIGVycm9yW0UwMjc3XTogYDxpbXBsIEl0ZXJhdG9yIGFzIEl0ZXJhdG9yPjo6SXRlbWAgZG9lc24ndCBpbXBsZW1lbnQgYHN0ZDo6Zm10OjpEaXNwbGF5YFxufVxuLy8gZW5kZnJhZ21lbnQgcmV0dXJuX2l0ZXJhdG9yXG59In1dfQ%3D%3D" target="_blank">&#x25B6;</a>
</div>
<pre class="language-rust" tabindex="0"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">vec_iter</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">i64</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">dyn</span> <span class="token class-name">Iterator</span> <span class="token punctuation">{</span> x<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token comment">// error[E0191]: the value of the associated type `Item` (from trait `Iterator`) must be specified</span></code></pre>
<p>Returning a generic trait is also (understandably) invalid</p>
<div class="code-play-button">
    <a href="https://godbolt.org/clientstate/eyJzZXNzaW9ucyI6W3siaWQiOjEsImxhbmd1YWdlIjoicnVzdCIsImNvbXBpbGVycyI6W3siaWQiOiJyMTYyMCJ9XSwiZXhlY3V0b3JzIjpbeyJjb21waWxlciI6eyJpZCI6InIxNjIwIn0sImNvbXBpbGVyT3V0cHV0VmlzaWJsZSI6InRydWUifV0sInNvdXJjZSI6InRyYWl0IE15VHJhaXQ8VD4ge1xuICAgIGZuIGZpcnN0X2VsZW1lbnQoJnNlbGYpIC0%2BIE9wdGlvbjxUPjtcbn1cbmltcGwgTXlUcmFpdDxpNjQ%2BIGZvciBWZWM8aTY0PiB7XG4gICAgZm4gZmlyc3RfZWxlbWVudCgmc2VsZikgLT4gT3B0aW9uPGk2ND4geyBOb25lIH1cbn1cbmZuIHZlY19pdGVyKHg6ICZWZWM8aTY0PikgLT4gaW1wbCBNeVRyYWl0IHsgeC5maXJzdF9lbGVtZW50KCkgfVxuICAgIC8vIF4gZXJyb3JbRTAxMDddOiBtaXNzaW5nIGdlbmVyaWNzIGZvciB0cmFpdCBgTXlUcmFpdGBcbmZuIG1haW4oKSB7fSJ9XX0%3D" target="_blank">&#x25B6;</a>
</div>
<pre class="language-rust" tabindex="0"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">vec_iter</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">i64</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">impl</span> <span class="token class-name">MyTrait</span> <span class="token punctuation">{</span> x<span class="token punctuation">.</span><span class="token function">first_element</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token comment">// ^ error[E0107]: missing generics for trait `MyTrait`</span></code></pre>
<p>Thus even in the above case, specifying the associated type is necessary in most cases.</p>
<h2 id="more-differences-multiple-associated-types" tabindex="-1">More differences - multiple associated types <a class="header-anchor" href="#more-differences-multiple-associated-types">#</a></h2>
<p>In the case of atrait having multiple associated types, it is valid to associate only one of them and use it.</p>
<div class="code-play-button">
    <a href="https://godbolt.org/clientstate/eyJzZXNzaW9ucyI6W3siaWQiOjEsImxhbmd1YWdlIjoicnVzdCIsImNvbXBpbGVycyI6W3siaWQiOiJyMTYyMCJ9XSwiZXhlY3V0b3JzIjpbeyJjb21waWxlciI6eyJpZCI6InIxNjIwIn0sImNvbXBpbGVyT3V0cHV0VmlzaWJsZSI6InRydWUifV0sInNvdXJjZSI6InRyYWl0IE15VHJhaXQge1xuICAgIHR5cGUgQTtcbiAgICB0eXBlIEI7XG5cbiAgICBmbiBkb3VibGVfYSgmc2VsZiwgYTogU2VsZjo6QSkgLT4gU2VsZjo6QTtcbiAgICBmbiBkb3VibGVfYigmc2VsZiwgYjogU2VsZjo6QikgLT4gU2VsZjo6Qjtcbn1cblxuc3RydWN0IEV4YW1wbGVTdHJ1Y3Q7XG5pbXBsIE15VHJhaXQgZm9yIEV4YW1wbGVTdHJ1Y3Qge1xuICAgIHR5cGUgQSA9IHUzMjtcbiAgICB0eXBlIEIgPSBmMzI7XG5cbiAgICBmbiBkb3VibGVfYSgmc2VsZiwgYTogU2VsZjo6QSkgLT4gU2VsZjo6QSB7IGEgKiAyIH1cbiAgICBmbiBkb3VibGVfYigmc2VsZiwgYjogU2VsZjo6QikgLT4gU2VsZjo6QiB7IGIgKiAyLjAgfVxufVxuXG5mbiBleGFtcGxlX2ZuKCkgLT4gaW1wbCBNeVRyYWl0PEEgPSB1MzI%2BIHsgRXhhbXBsZVN0cnVjdHt9IH1cblxuZm4gbWFpbigpIHtcbiAgICBsZXQgeCA9IGV4YW1wbGVfZm4oKTtcbiAgICBwcmludGxuIShcInt9XCIsIHguZG91YmxlX2EoMikpO1xuICAgIHByaW50bG4hKFwie31cIiwgeC5kb3VibGVfYigyLjApKTtcbiAgICAvLyBlcnJvcltFMDI3N106IGA8aW1wbCBNeVRyYWl0PEEgPSB1MzI%2BIGFzIE15VHJhaXQ%2BOjpCYCBkb2Vzbid0IGltcGxlbWVudCBgc3RkOjpmbXQ6OkRpc3BsYXlgXG59In1dfQ%3D%3D" target="_blank">&#x25B6;</a>
</div>
<pre class="language-rust" tabindex="0"><code class="language-rust"><span class="token keyword">trait</span> <span class="token type-definition class-name">MyTrait</span> <span class="token punctuation">{</span>
    <span class="token keyword">type</span> <span class="token type-definition class-name">A</span><span class="token punctuation">;</span>
    <span class="token keyword">type</span> <span class="token type-definition class-name">B</span><span class="token punctuation">;</span>

    <span class="token keyword">fn</span> <span class="token function-definition function">double_a</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> a<span class="token punctuation">:</span> <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">A</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">A</span><span class="token punctuation">;</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">double_b</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">B</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">B</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">fn</span> <span class="token function-definition function">example_fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">impl</span> <span class="token class-name">MyTrait</span><span class="token operator">&lt;</span><span class="token class-name">A</span> <span class="token operator">=</span> <span class="token keyword">u32</span><span class="token operator">></span> <span class="token punctuation">{</span> <span class="token class-name">ExampleStruct</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">example_fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> x<span class="token punctuation">.</span><span class="token function">double_a</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> x<span class="token punctuation">.</span><span class="token function">double_b</span><span class="token punctuation">(</span><span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// error[E0277]: `&lt;impl MyTrait&lt;A = u32> as MyTrait>::B` doesn't implement `std::fmt::Display`</span>
<span class="token punctuation">}</span></code></pre>
<p>This does not seem as useful as traits are intended to be &quot;small / composable&quot;, so if you have multiple associated types, you are likely using all of them or none of them.</p>
<h2 id="my-mental-model" tabindex="-1">My mental model <a class="header-anchor" href="#my-mental-model">#</a></h2>
<ul>
<li>I believe that there is only one real difference between them is the single implementation of a trait constraint.</li>
<li>For usage, you should treat them as generic traits everywhere. Always specify the associated types. Thus this difference only affects trait implementors.</li>
<li>According to me, a slightly more intuitive syntax would be something that consistently enforces associated type specification in usage.</li>
</ul>
<details>
<summary>My unpolished syntax alternative</summary>
<p>What about something like?</p>
<pre class="language-rust" tabindex="0"><code class="language-rust"><span class="token keyword">trait</span> <span class="token type-definition class-name">Iterator</span><span class="token operator">&lt;</span><span class="token class-name">Item</span><span class="token operator">></span> <span class="token punctuation">{</span>
	<span class="token comment">// no type statement, it becomes a generic argument consistenly</span>
	require unique implementation <span class="token keyword">for</span> <span class="token operator">&lt;</span><span class="token class-name">Item</span><span class="token operator">></span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token class-name">Iterator</span><span class="token operator">&lt;</span><span class="token class-name">Item</span><span class="token operator">=</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token keyword">for</span> <span class="token class-name">Vector</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token punctuation">{</span> <span class="token punctuation">...</span> <span class="token punctuation">}</span>

<span class="token keyword">trait</span> <span class="token type-definition class-name">ToPairs</span><span class="token operator">&lt;</span><span class="token class-name">Item1</span><span class="token punctuation">,</span> <span class="token class-name">Item2</span><span class="token operator">></span> <span class="token punctuation">{</span>
	require unique implementation <span class="token keyword">for</span> <span class="token operator">&lt;</span><span class="token class-name">Item1</span><span class="token punctuation">,</span> <span class="token class-name">Item2</span><span class="token operator">></span>
<span class="token punctuation">}</span>

<span class="token keyword">trait</span> <span class="token type-definition class-name">NDShape</span><span class="token operator">&lt;</span><span class="token class-name">BaseUnit</span><span class="token punctuation">,</span> <span class="token class-name">PerimeterUnit</span><span class="token punctuation">,</span> <span class="token class-name">AreaUnit</span><span class="token operator">></span> <span class="token punctuation">{</span>
	<span class="token comment">// PerimeterUnit &amp; AreaUnit are associated types, but BaseUnit is not</span>
	require unique implementation <span class="token keyword">for</span> <span class="token operator">&lt;</span><span class="token class-name">BaseUnit</span><span class="token operator">></span>
<span class="token punctuation">}</span></code></pre>
<p>(I admit its not great though)</p>
<p>Aside: In nightly, there is <code>#![feature(associated_type_defaults)]</code> which affects trait implementors, not users, by providing defaults for associated types.</p>
</details>

<ul class="links-nextprev"><li>Previous: <a href="/blog/posts/c++-force-inline/">Force Inline in C++</a></li><li>Next: <a href="/blog/posts/crabtime-leptos-icons/">Using Crabtime for including icons in Leptos</a></li>

<script src="/blog/js/index.js"></script>
<script src="https://utteranc.es/client.js" repo="meghprkh/blog" issue-term="pathname" label="comments" theme="preferred-color-scheme" crossorigin="anonymous" async="">
</script>


		</ul></main>

		<footer></footer>

		<!-- This page `/blog/posts/rust-traits-associated-types-generic-traits/` was built on 2025-04-30T06:22:10.273Z -->
	</body>

	<script data-goatcounter="https://meghprkh.goatcounter.com/count" async="" src="//gc.zgo.at/count.js"></script>
	<noscript>
		<img src="https://meghprkh.goatcounter.com/count?p=/blog/blog/posts/rust-traits-associated-types-generic-traits/?noscript">
	</noscript>
</html>
