<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Using Crabtime for including icons in Leptos</title>
		<meta name="description" content="Ramblings and dumb ideas">
		<link rel="alternate" href="/blog/feed/feed.xml" type="application/atom+xml" title="Megh&#39;s Blog">
		<link rel="alternate" href="/blog/feed/feed.json" type="application/json" title="Megh&#39;s Blog">
		
		<style>/**
 * okaidia theme for JavaScript, CSS and HTML
 * Loosely based on Monokai textmate theme by http://www.monokai.nl/
 * @author ocodia
 */

code[class*="language-"],
pre[class*="language-"] {
	color: #f8f8f2;
	background: none;
	text-shadow: 0 1px rgba(0, 0, 0, 0.3);
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
	border-radius: 0.3em;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #272822;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: #8292a2;
}

.token.punctuation {
	color: #f8f8f2;
}

.token.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.constant,
.token.symbol,
.token.deleted {
	color: #f92672;
}

.token.boolean,
.token.number {
	color: #ae81ff;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #a6e22e;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string,
.token.variable {
	color: #f8f8f2;
}

.token.atrule,
.token.attr-value,
.token.function,
.token.class-name {
	color: #e6db74;
}

.token.keyword {
	color: #66d9ef;
}

.token.regex,
.token.important {
	color: #fd971f;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
/*
 * New diff- syntax
 */

pre[class*="language-diff-"] {
	--eleventy-code-padding: 1.25em;
	padding-left: var(--eleventy-code-padding);
	padding-right: var(--eleventy-code-padding);
}
.token.deleted {
	background-color: hsl(0, 51%, 37%);
	color: inherit;
}
.token.inserted {
	background-color: hsl(126, 31%, 39%);
	color: inherit;
}

/* Make the + and - characters unselectable for copy/paste */
.token.prefix.unchanged,
.token.prefix.inserted,
.token.prefix.deleted {
	-webkit-user-select: none;
	user-select: none;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	padding-top: 2px;
	padding-bottom: 2px;
}
.token.prefix.inserted,
.token.prefix.deleted {
	width: var(--eleventy-code-padding);
	background-color: rgba(0, 0, 0, 0.2);
}

/* Optional: full-width background color */
.token.inserted:not(.prefix),
.token.deleted:not(.prefix) {
	display: block;
	margin-left: calc(-1 * var(--eleventy-code-padding));
	margin-right: calc(-1 * var(--eleventy-code-padding));
	text-decoration: none; /* override del, ins, mark defaults */
	color: inherit; /* override del, ins, mark defaults */
}
* { box-sizing: border-box; }
/* Defaults */
:root {
	--font-family: -apple-system, system-ui, sans-serif;
	--font-family-monospace:
		Consolas, Menlo, Monaco, Andale Mono WT, Andale Mono, Lucida Console,
		Lucida Sans Typewriter, DejaVu Sans Mono, Bitstream Vera Sans Mono,
		Liberation Mono, Nimbus Mono L, Courier New, Courier, monospace;
}

/* Theme colors */
:root {
	--color-gray-20: #e0e0e0;
	--color-gray-50: #c0c0c0;
	--color-gray-90: #333;

	--background-color: #fff;

	--text-color: var(--color-gray-90);
	--text-color-link: #082840;
	--text-color-link-active: #5f2b48;
	--text-color-link-visited: #17050f;

	--syntax-tab-size: 2;
}

@media (prefers-color-scheme: dark) {
	:root {
		--color-gray-20: #e0e0e0;
		--color-gray-50: #c0c0c0;
		--color-gray-90: #dad8d8;

		/* --text-color is assigned to --color-gray-_ above */
		--text-color-link: #1493fb;
		--text-color-link-active: #6969f7;
		--text-color-link-visited: #a6a6f8;

		--background-color: #15202b;
	}
}

/* Global stylesheet */
* {
	box-sizing: border-box;
}

html,
body {
	padding: 0;
	margin: 0 auto;
	font-family: var(--font-family);
	color: var(--text-color);
	background-color: var(--background-color);
}
html {
	overflow-y: scroll;
}
body {
	max-width: 50em;
}

/* https://www.a11yproject.com/posts/how-to-hide-content/ */
.visually-hidden {
	clip: rect(0 0 0 0);
	clip-path: inset(50%);
	height: 1px;
	overflow: hidden;
	position: absolute;
	white-space: nowrap;
	width: 1px;
}

p:last-child {
	margin-bottom: 0;
}
p {
	line-height: 1.5;
}

li {
	line-height: 1.5;
}

a[href] {
	color: var(--text-color-link);
}
a[href]:visited {
	color: var(--text-color-link-visited);
}
a[href]:hover,
a[href]:active {
	color: var(--text-color-link-active);
}

main {
	padding: 1rem;
}
main :first-child {
	margin-top: 0;
}

header {
	border-bottom: 1px dashed var(--color-gray-20);
}
header:after {
	content: "";
	display: table;
	clear: both;
}

.links-nextprev {
	list-style: none;
	border-top: 1px dashed var(--color-gray-20);
	padding: 1em 0;
}

table {
	margin: 1em 0;
}
table td,
table th {
	padding-right: 1em;
}

pre,
code,
code[class*="language-"],
pre[class*="language-"] {
	font-family: var(--font-family-monospace);
	font-size: 0.95em;
	line-height: 1.5;
}
pre:not([class*="language-"]) {
	background: #272822;
	padding: 1em;
	margin: 0.5em 0;
	overflow: auto;
	line-height: 1.375; /* 22px /16 */
	-moz-tab-size: var(--syntax-tab-size);
	-o-tab-size: var(--syntax-tab-size);
	tab-size: var(--syntax-tab-size);
	-webkit-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
	direction: ltr;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
}
code {
	word-break: break-all;
}

/* Header */
header {
	display: flex;
	gap: 1em 0.5em;
	flex-wrap: wrap;
	align-items: center;
	padding: 1em;
}
.home-link {
	font-size: 1em; /* 16px /16 */
	font-weight: 700;
	margin-right: 2em;
}
.home-link:link:not(:hover) {
	text-decoration: none;
}

/* Nav */
.nav {
	display: flex;
	padding: 0;
	margin: 0;
	list-style: none;
}
.nav-item {
	display: inline-block;
	margin-right: 1em;
}
.nav-item a[href]:not(:hover) {
	text-decoration: none;
}
.nav a[href][aria-current="page"] {
	text-decoration: underline;
}

/* Posts list */
.postlist {
	list-style: none;
	padding: 0;
	padding-left: 1.5rem;
}
.postlist-item {
	display: flex;
	flex-wrap: wrap;
	align-items: baseline;
	counter-increment: start-from -1;
	margin-bottom: 1em;
}
.postlist-item:before {
	display: inline-block;
	pointer-events: none;
	content: "" counter(start-from, decimal-leading-zero) ". ";
	line-height: 100%;
	text-align: right;
	margin-left: -1.5rem;
}
.postlist-date,
.postlist-item:before {
	font-size: 0.8125em; /* 13px /16 */
	color: var(--color-gray-90);
}
.postlist-date {
	word-spacing: -0.5px;
}
.postlist-link {
	font-size: 1.1875em; /* 19px /16 */
	font-weight: 700;
	flex-basis: calc(100% - 1.5rem);
	padding-left: 0.25em;
	padding-right: 0.5em;
	text-underline-position: from-font;
	text-underline-offset: 0;
	text-decoration-thickness: 1px;
}
.postlist-item-active .postlist-link {
	font-weight: bold;
}

/* Tags */
.post-tag {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	text-transform: capitalize;
	font-style: italic;
}
.postlist-item > .post-tag {
	align-self: center;
}

/* Tags list */
.post-metadata {
	display: inline-flex;
	flex-wrap: wrap;
	gap: 0.5em;
	list-style: none;
	padding: 0;
	margin: 0;
}
.post-metadata time {
	margin-right: 1em;
}

/* Direct Links / Markdown Headers */
.header-anchor {
	text-decoration: none;
	font-style: normal;
	font-size: 1em;
	margin-left: 0.1em;
}
a[href].header-anchor,
a[href].header-anchor:visited {
	color: transparent;
}
a[href].header-anchor:focus,
a[href].header-anchor:hover {
	text-decoration: underline;
}
a[href].header-anchor:focus,
:hover > a[href].header-anchor {
	color: #aaa;
}

h2 + .header-anchor {
	font-size: 1.5em;
}

/* Modified */
table,
th,
td {
	border: 1px solid;
	padding: 0.5em;
}

table {
	width: 100%;
	border-collapse: collapse;
}

/* Table of Contents */
#TableOfContents {
	margin: 1em 0em;
}
#TableOfContents > nav > ol::before {
	content: "Table of Contents";
	font-weight: bold;
	text-align: center;
	display: block;
	margin-left: -1.25em;
}

#TableOfContents > nav > ol {
	border: 1px dashed var(--color-gray-90);
	padding: 0.75em 0.75em 0.75em 2em;
}

#TableOfContents .active {
	color: var(--text-color-link-active);
}

@media (min-width: 80em) {
	#TableOfContents {
		display: block;
		width: calc(50vw - 29em);
		max-width: 20em;
		position: -webkit-sticky;
		position: sticky;
		height: 0;
		top: 3.5em;
		margin: 0em;
		margin-left: 52em;
		background: none;
	}
}

/* Misc */
.code-play-button {
	position: relative;
}

.code-play-button a {
	position: absolute;
	text-decoration: none;
	right: 0em;
	width: 1.25em;
	display: inline-block;
	font-size: 1.5em;
	color: white;
	content: "\25B6";
}</style>
	</head>
	<body>
		<a href="#skip" class="visually-hidden">Skip to main content</a>

		<header>
			<a href="/blog/" class="home-link">Megh&#39;s Blog</a>
			<nav>
				<h2 class="visually-hidden">Top level navigation menu</h2>
				<ul class="nav">
					<li class="nav-item"><a href="/blog/">Home</a></li>
					<li class="nav-item"><a href="/blog/archive/">Archive</a></li>
					<li class="nav-item"><a href="/blog/about/">About Me</a></li>
					<li class="nav-item"><a href="https://meghprkh.github.io/">Portfolio</a></li>
				</ul>
			</nav>
		</header>

		<main id="skip">
			
<h1>Using Crabtime for including icons in Leptos</h1>

<ul class="post-metadata">
	<li><time datetime="2025-04-30">30 April 2025</time></li>
	<li><a href="/blog/tags/rust/" class="post-tag">Rust</a>, </li>
	<li><a href="/blog/tags/leptos/" class="post-tag">Leptos</a>, </li>
	<li><a href="/blog/tags/crabtime/" class="post-tag">crabtime</a></li>
</ul>

<aside id="TableOfContents">
  <nav class="toc">
        <ol><li><a href="#the-raw-icon-content-macro">The raw_icon_content! macro</a></li><li><a href="#the-define-icon-component-macro">The define_icon_component! macro</a></li><li><a href="#handling-size-and-stroke-width">Handling size and stroke_width</a></li><li><a href="#asides">Asides</a><ol><li><a href="#why-not-include-view">Why not include_view!?</a></li><li><a href="#crabtime-and-errors">Crabtime and errors</a></li><li><a href="#crabtime-and-string-escaping">Crabtime and string escaping</a></li></ol></li><li><a href="#summary">Summary</a></li></ol>
      </nav>
</aside>
<p>TLDR: Using <a href="https://docs.rs/crabtime/latest/crabtime/"><code>crabtime</code></a> to easily embed icons in <a href="https://leptos.dev/">Leptos</a> like how you would do it in ReactJS ðŸ¦€ðŸ¦€</p>
<p>Web development in Rust is exciting. While exploring Leptos, I ran into issues adding icons â€” but managed to solve them using <code>crabtime</code>.</p>
<!-- more -->
<p>Icon fonts like FontAwesome are outdated; embedding SVGs wiht includes directly is now preferred. Libraries like <a href="https://lucide.dev/">Lucide</a> use Javascript for this, and Rust ports like <a href="https://github.com/opensourcecheemsburgers/leptos_lucide/"><code>leptos_lucide</code></a> &amp; <a href="https://lucide.rustforweb.org/frameworks/leptos.html"><code>lucide-leptos</code></a> offer similar functionality. This gives you tree shaking, only including the icons you need. Other things like <code>currentColor</code>, <code>size</code>, etc work too. However generating a component per icon, for 2000+ icons, compile times skyrocket.</p>
<p>I used <code>crabtime</code>, which gives Zig-like compile time functions, to easily create macros. The idea then is to explictly define what icons we want to use in the project and only pay compile time costs for them.</p>
<h2 id="the-raw-icon-content-macro" tabindex="-1">The <code>raw_icon_content!</code> macro <a class="header-anchor" href="#the-raw-icon-content-macro">#</a></h2>
<p>First lets create a small macro to include and escape the content of a macro. This is very similar to <a href="https://doc.rust-lang.org/std/macro.include_str.html#examples">std::include_str!</a> but shows basic crabtime usage and assumes paths for our icons.</p>
<pre class="language-rust" tabindex="0"><code class="language-rust"><span class="token attribute attr-name">#[crabtime::expression]</span>
<span class="token attribute attr-name">#[macro_export]</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">raw_icon_content</span><span class="token punctuation">(</span>icon_name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">String</span> <span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>path<span class="token punctuation">::</span></span><span class="token class-name">Path</span><span class="token punctuation">;</span>

    <span class="token comment">// Assumes lucide-static via npm, but any source for the icon files works.</span>
    <span class="token keyword">let</span> icon_path <span class="token operator">=</span> <span class="token class-name">Path</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token namespace">crabtime<span class="token punctuation">::</span></span><span class="token constant">WORKSPACE_PATH</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">"node_modules/lucide-static/icons"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"{icon_name}.svg"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> icon_content <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>fs<span class="token punctuation">::</span></span><span class="token function">read_to_string</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>icon_path<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap_or_else</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>_<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
        <span class="token macro property">panic!</span><span class="token punctuation">(</span><span class="token string">"Could not open file {}"</span><span class="token punctuation">,</span> icon_path<span class="token punctuation">.</span><span class="token function">to_string_lossy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Note the output is interepreted as Rust code, so it needs to be escaped</span>
    <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"r##\"{icon_content}\"##"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
<p>To use this in a leptos component, do:</p>
<pre class="language-rust" tabindex="0"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">leptos<span class="token punctuation">::</span></span><span class="token punctuation">{</span>html<span class="token punctuation">,</span> <span class="token namespace">prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token macro property">view!</span> <span class="token punctuation">{</span>
    <span class="token operator">&lt;</span>i <span class="token punctuation">{</span><span class="token namespace">html<span class="token punctuation">::</span></span><span class="token function">inner_html</span><span class="token punctuation">(</span><span class="token macro property">raw_icon_content!</span><span class="token punctuation">(</span><span class="token string">"menu"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token punctuation">}</span></code></pre>
<p>If we were to <code>cargo expand</code> the line <code>raw_icon_content!(&quot;menu&quot;)</code>, it would read something like</p>
<pre class="language-rust" tabindex="0"><code class="language-rust"><span class="token string">r##"
&lt;!-- license lucide-static v0.503.0 - ISC -->
&lt;svg width="24" height="24" stroke="currentColor"> &lt;line .. /> &lt;/svg>
"##</span></code></pre>
<p>(The exact SVG content can be found <a href="https://github.com/lucide-icons/lucide/blob/main/icons/menu.svg?short_path=c68f00d">here</a>)</p>
<h2 id="the-define-icon-component-macro" tabindex="-1">The <code>define_icon_component!</code> macro <a class="header-anchor" href="#the-define-icon-component-macro">#</a></h2>
<p>However if we were to include each icon in every component we will have duplicated icon strings (not sure if optimization helps there). It also doesnt give us a nice &quot;component&quot; API. So lets define a <code>define_icon_component</code> macro where we see some ``crabtime` power</p>
<pre class="language-rust" tabindex="0"><code class="language-rust"><span class="token comment">// filename: icons.rs</span>

<span class="token attribute attr-name">#[crabtime::function]</span>
<span class="token attribute attr-name">#[macro_export]</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">define_icon_component</span><span class="token punctuation">(</span>component_name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> icon_name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> quoted_icon_name <span class="token operator">=</span> <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"\"{icon_name}\""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token namespace">crabtime<span class="token punctuation">::</span></span><span class="token macro property">output!</span><span class="token punctuation">(</span>
        <span class="token attribute attr-name">#[component]</span>
        <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>component_name<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">impl</span> <span class="token class-name">IntoView</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> content <span class="token operator">=</span> <span class="token macro property">raw_icon_content!</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">{</span>quoted_icon_name<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token macro property">view!</span> <span class="token punctuation">{</span>
                <span class="token operator">&lt;</span>i <span class="token punctuation">{</span><span class="token namespace">html<span class="token punctuation">::</span></span><span class="token function">inner_html</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token macro property">define_icon_component!</span><span class="token punctuation">(</span><span class="token class-name">Menu</span><span class="token punctuation">,</span> <span class="token string">"menu"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>This allows us to use the component as <code>&lt;icons::Menu /&gt;</code> in other components. This is where crabtime really shines, allowing us to write Rust code as string template-y code generation. There are some annoyances about having to re-escape strings, especially since it has to be done out of line, but otherwise it works like magic!</p>
<h2 id="handling-size-and-stroke-width" tabindex="-1">Handling <code>size</code> and <code>stroke_width</code> <a class="header-anchor" href="#handling-size-and-stroke-width">#</a></h2>
<p>Enhancing the <code>define_icon_component!</code> macro with some CSS and props allows us to handle sizing and stroke-width.</p>
<pre class="language-css" tabindex="0"><code class="language-css"><span class="token comment">/* file: index.css - or use inline css, or a library like stylers */</span>
<span class="token selector">.icon > svg</span> <span class="token punctuation">{</span>
	<span class="token property">width</span><span class="token punctuation">:</span> inherit<span class="token punctuation">;</span>
	<span class="token property">height</span><span class="token punctuation">:</span> inherit<span class="token punctuation">;</span>
	<span class="token property">stroke-width</span><span class="token punctuation">:</span> inherit<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<pre class="language-rust" tabindex="0"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>component_name<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">(</span>
    <span class="token attribute attr-name">#[prop(default = 24)]</span> size<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
    <span class="token attribute attr-name">#[prop(default = 2)]</span> stroke_width<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">impl</span> <span class="token class-name">IntoView</span> <span class="token punctuation">{</span>
      <span class="token comment">// ....</span>
          <span class="token operator">&lt;</span>i
              style<span class="token punctuation">:</span>height<span class="token operator">=</span><span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"{}px"</span><span class="token punctuation">,</span> size<span class="token punctuation">)</span>
              style<span class="token punctuation">:</span>width<span class="token operator">=</span><span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"{}px"</span><span class="token punctuation">,</span> size<span class="token punctuation">)</span>
              style<span class="token punctuation">:</span>stroke<span class="token operator">-</span>width<span class="token operator">=</span><span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"{}px"</span><span class="token punctuation">,</span> stroke_width<span class="token punctuation">)</span>
              class<span class="token operator">=</span><span class="token string">"icon"</span>
              <span class="token punctuation">{</span><span class="token namespace">html<span class="token punctuation">::</span></span><span class="token function">inner_html</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token punctuation">}</span></code></pre>
<p>and now we use it as</p>
<pre class="language-rust" tabindex="0"><code class="language-rust"><span class="token comment">// file: navbar.rs</span>
<span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token module-declaration namespace"><span class="token punctuation">::</span>icons</span><span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">Navbar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token macro property">view!</span> <span class="token punctuation">{</span>
        <span class="token operator">&lt;</span><span class="token namespace">icons<span class="token punctuation">::</span></span><span class="token class-name">Menu</span> size<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">48</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h2 id="asides" tabindex="-1">Asides <a class="header-anchor" href="#asides">#</a></h2>
<h3 id="why-not-include-view" tabindex="-1">Why not <code>include_view!</code>? <a class="header-anchor" href="#why-not-include-view">#</a></h3>
<p>Leptos comes with a macro to include an external view, but this will try to parse it as the content of a <code>view!</code> macro. We want it to be inner html. Specifically HTML comments are a problem - <a href="https://github.com/leptos-rs/leptos/issues/3887">Github issue</a></p>
<h3 id="crabtime-and-errors" tabindex="-1">Crabtime and errors <a class="header-anchor" href="#crabtime-and-errors">#</a></h3>
<p>I am unsure if <code>panic</code>-ing or <code>crabtime::error</code> is the way to go. In stable, <code>error</code> only logs it in the console, but does not fail the compilation. <a href="https://docs.rs/crabtime/latest/crabtime/#-logging--debugging">Behaviour Reference</a>.</p>
<h3 id="crabtime-and-string-escaping" tabindex="-1">Crabtime and string escaping <a class="header-anchor" href="#crabtime-and-string-escaping">#</a></h3>
<p>I am unsure if there is a better way to do this, but string escaping is suggested <a href="https://docs.rs/crabtime/latest/crabtime/#-output">here</a> under the note &quot;Interpolated variables are inserted as-is, without additional quotes or escape characters.&quot;</p>
<p>It would be nice if crabtime provides an <code>crabtime::escape_string!</code> macro that works and can be used inline inside a <code>crabtime::output!</code> - <a href="https://github.com/wdanilo/crabtime/issues/37">Github Issue</a></p>
<pre class="language-rust" tabindex="0"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">escape_string</span><span class="token punctuation">(</span>in_str<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">String</span> <span class="token punctuation">{</span>
    <span class="token comment">// this implementation uses hacky hash counting but it can be smarter if it wants</span>
    <span class="token keyword">let</span> num_hashes <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token operator">&amp;</span>n<span class="token closure-punctuation punctuation">|</span></span> <span class="token operator">!</span>in_str<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token string">"#"</span><span class="token punctuation">.</span><span class="token function">repeat</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> hashes <span class="token operator">=</span> <span class="token string">"#"</span><span class="token punctuation">.</span><span class="token function">repeat</span><span class="token punctuation">(</span>num_hashes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"r{hashes}\"{in_str}\"{hashes}"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[crabtime::expression]</span>
<span class="token attribute attr-name">#[macro_export]</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">identity_string</span><span class="token punctuation">(</span>icon_name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">String</span> <span class="token punctuation">{</span>
    <span class="token namespace">crabtime<span class="token punctuation">::</span></span><span class="token macro property">output!</span> <span class="token punctuation">{</span>
        <span class="token namespace">crabtime<span class="token punctuation">::</span></span><span class="token macro property">escape_string!</span><span class="token punctuation">(</span>icon_name<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token macro property">identity_string!</span><span class="token punctuation">(</span><span class="token string">"A#\"b"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// should be</span>
<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token string">r##"A#"b"##</span><span class="token punctuation">;</span></code></pre>
<h2 id="summary" tabindex="-1">Summary <a class="header-anchor" href="#summary">#</a></h2>
<p>This was my first time using both Leptos and crabtime. While the initial pain was high, and the macro errors are still hard to debug sometimes, crabtime really makes solving these problems fun imo.</p>
<details>
<summary>Full code (click to expand)</summary>
<pre class="language-rust" tabindex="0"><code class="language-rust"><span class="token comment">// SPDX-FileCopyrightText: 2025 Megh Parikh (https://meghprkh.mit-license.org/)</span>
<span class="token comment">// SPDX-License-Identifier: MIT or MIT-0</span>

<span class="token keyword">use</span> <span class="token namespace">leptos<span class="token punctuation">::</span></span><span class="token punctuation">{</span>html<span class="token punctuation">,</span> <span class="token namespace">prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[crabtime::expression]</span>
<span class="token attribute attr-name">#[macro_export]</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">raw_icon_content</span><span class="token punctuation">(</span>icon_name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">String</span> <span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>path<span class="token punctuation">::</span></span><span class="token class-name">Path</span><span class="token punctuation">;</span>

    <span class="token keyword">fn</span> <span class="token function-definition function">escape_string</span><span class="token punctuation">(</span>in_str<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">String</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> num_hashes <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token operator">&amp;</span>n<span class="token closure-punctuation punctuation">|</span></span> <span class="token operator">!</span>in_str<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token string">"#"</span><span class="token punctuation">.</span><span class="token function">repeat</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> hashes <span class="token operator">=</span> <span class="token string">"#"</span><span class="token punctuation">.</span><span class="token function">repeat</span><span class="token punctuation">(</span>num_hashes<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"r{hashes}\"{in_str}\"{hashes}"</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> icon_path <span class="token operator">=</span> <span class="token class-name">Path</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token namespace">crabtime<span class="token punctuation">::</span></span><span class="token constant">WORKSPACE_PATH</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">"node_modules/lucide-static/icons"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"{icon_name}.svg"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> icon_content <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>fs<span class="token punctuation">::</span></span><span class="token function">read_to_string</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>icon_path<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap_or_else</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>_<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
        <span class="token namespace">crabtime<span class="token punctuation">::</span></span><span class="token macro property">error!</span><span class="token punctuation">(</span><span class="token string">"Could not open file {}"</span><span class="token punctuation">,</span> icon_path<span class="token punctuation">.</span><span class="token function">to_string_lossy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token macro property">panic!</span><span class="token punctuation">(</span><span class="token string">"Could not open file {}"</span><span class="token punctuation">,</span> icon_path<span class="token punctuation">.</span><span class="token function">to_string_lossy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">escape_string</span><span class="token punctuation">(</span>icon_content<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[crabtime::function]</span>
<span class="token attribute attr-name">#[macro_export]</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">define_icon_component</span><span class="token punctuation">(</span>component_name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> icon_name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> quoted_icon_name <span class="token operator">=</span> <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"\"{icon_name}\""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token namespace">crabtime<span class="token punctuation">::</span></span><span class="token macro property">output!</span><span class="token punctuation">(</span>
        <span class="token attribute attr-name">#[component]</span>
        <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>component_name<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">(</span>
            <span class="token attribute attr-name">#[prop(default = 24)]</span> size<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
            <span class="token attribute attr-name">#[prop(default = 2)]</span> stroke_width<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">impl</span> <span class="token class-name">IntoView</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> content <span class="token operator">=</span> <span class="token macro property">raw_icon_content!</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">{</span>quoted_icon_name<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token macro property">view!</span> <span class="token punctuation">{</span>
                <span class="token operator">&lt;</span>i
                    style<span class="token punctuation">:</span>height<span class="token operator">=</span><span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"{}px"</span><span class="token punctuation">,</span> size<span class="token punctuation">)</span>
                    style<span class="token punctuation">:</span>width<span class="token operator">=</span><span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"{}px"</span><span class="token punctuation">,</span> size<span class="token punctuation">)</span>
                    style<span class="token punctuation">:</span>stroke<span class="token operator">-</span>width<span class="token operator">=</span><span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"{}px"</span><span class="token punctuation">,</span> stroke_width<span class="token punctuation">)</span>
                    class<span class="token operator">=</span><span class="token string">"icon"</span>
                    <span class="token punctuation">{</span><span class="token namespace">html<span class="token punctuation">::</span></span><span class="token function">inner_html</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token macro property">define_icon_component!</span><span class="token punctuation">(</span><span class="token class-name">Menu</span><span class="token punctuation">,</span> <span class="token string">"menu"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</details>

<ul class="links-nextprev"><li>Previous: <a href="/blog/posts/rust-traits-associated-types-generic-traits/">Rust Traits - Associated Types and Generic Traits</a></li>

<script src="/blog/js/index.js"></script>
<script src="https://utteranc.es/client.js" repo="meghprkh/blog" issue-term="pathname" label="comments" theme="preferred-color-scheme" crossorigin="anonymous" async="">
</script>


		</ul></main>

		<footer></footer>

		<!-- This page `/blog/posts/crabtime-leptos-icons/` was built on 2025-04-30T06:22:10.270Z -->
	</body>

	<script data-goatcounter="https://meghprkh.goatcounter.com/count" async="" src="//gc.zgo.at/count.js"></script>
	<noscript>
		<img src="https://meghprkh.goatcounter.com/count?p=/blog/blog/posts/crabtime-leptos-icons/?noscript">
	</noscript>
</html>
